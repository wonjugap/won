<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹ ì›ì£¼ê°‘ ë‹¹ì›ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Firebase SDK v10 (ìµœì‹  ì•ˆì • ë²„ì „) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, updateDoc, onSnapshot, enableNetwork, disableNetwork } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        import { connectFirestoreEmulator } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        
  // Firebase í”„ë¡œì íŠ¸ ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyAFAsd9XBblWD1G2vVrP48T9IQqwWoDZro",
            authDomain: "wonju-minjoo-member-system.firebaseapp.com",
            projectId: "wonju-minjoo-member-system",
            storageBucket: "wonju-minjoo-member-system.firebasestorage.app",
            messagingSenderId: "227156177261",
            appId: "1:227156177261:web:9f37ea54dab14265c2aa64"
        };

        let app, db;
        let isFirebaseReady = false;
        let connectionRetryCount = 0;
        const maxRetries = 3;
        
        // ì•ˆì „í•œ í•¨ìˆ˜ í˜¸ì¶œ í—¬í¼
        function safeCallFunction(functionName, ...args) {
            try {
                console.log(`ğŸ”§ ${functionName} í•¨ìˆ˜ í˜¸ì¶œ ì‹œì‘`);
                
                const func = window[functionName];
                if (typeof func !== 'function') {
                    console.error(`âŒ ${functionName} í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                    alert(`âŒ ${functionName} í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.`);
                    return null;
                }
                
                const firebaseFunctions = [
                    'loadMemberDataFromFirebase',
                    'loadMemberDataFromFirebaseInTab', 
                    'loadFirebaseDataDirectly',
                    'syncMemberDataToFirebase',
                    'syncUsersToFirebase',
                    'loadUsersFromFirebase'
                ];
                
                if (firebaseFunctions.includes(functionName)) {
                    if (!window.firebaseInitialized && functionName !== 'checkFirebaseConnection') {
                        console.warn(`âš ï¸ Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ì§€ë§Œ ${functionName} í˜¸ì¶œ ì‹œë„`);
                        alert('âš ï¸ Firebase ì—°ê²°ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì‘ì—…í•˜ê±°ë‚˜ Firebase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        return null;
                    }
                }
                
                let result;
                try {
                    result = func(...args);
                } catch (execError) {
                    console.error(`âŒ ${functionName} ì‹¤í–‰ ì¤‘ ì˜ˆì™¸ ë°œìƒ:`, execError);
                    alert(`âŒ ${functionName} ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n${execError.message}`);
                    return null;
                }
                
                if (result && typeof result.then === 'function') {
                    console.log(`âš¡ ${functionName}ê°€ Promiseë¥¼ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤`);
                    result.then((success) => {
                        console.log(`âœ… ${functionName} Promise ì„±ê³µ ì™„ë£Œ:`, success);
                    }).catch((error) => {
                        console.error(`âŒ ${functionName} Promise ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜:`, error);
                        alert(`âŒ ${functionName} ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n${error.message}`);
                    });
                } else {
                    console.log(`âœ… ${functionName} í•¨ìˆ˜ ì™„ë£Œ (ë™ê¸° ì‹¤í–‰), ë°˜í™˜ê°’:`, typeof result);
                }
                
                return result;
                
            } catch (error) {
                console.error(`âŒ ${functionName} í˜¸ì¶œ ì¤‘ ì˜ˆì™¸ ë°œìƒ:`, error);
                alert(`âŒ ${functionName} í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n${error.message}\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.`);
                return null;
            }
        }

        window.safeCallFunction = safeCallFunction;
        
        // Firebase ë°ì´í„° ì„¹ì…˜ ìˆ¨ê¸°ê¸°
        function hideFirebaseDataSection() {
            const section = document.getElementById('firebaseDataSection');
            if (section) {
                section.style.display = 'none';
            }
        }
        
        // Firebase ë°ì´í„° ì§ì ‘ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFirebaseDataDirectly() {
            console.log('loadFirebaseDataDirectly í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            if (!window.loadMemberDataFromFirebase) {
                console.error('loadMemberDataFromFirebase í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                alert('âŒ Firebase ë°ì´í„° ë¡œë“œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì‘ì—…í•˜ê±°ë‚˜ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!window.checkFirebaseConnection || !window.checkFirebaseConnection()) {
                alert('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\nì˜¤í”„ë¼ì¸ ëª¨ë“œì—ì„œëŠ” ë¡œì»¬ íŒŒì¼ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                const loadResult = window.loadMemberDataFromFirebase();
                
                if (!loadResult) {
                    console.error('loadMemberDataFromFirebaseê°€ null/undefinedë¥¼ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤');
                    alert('âŒ Firebase ë°ì´í„° ë¡œë“œ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.\nì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì‘ì—…í•˜ê±°ë‚˜ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                if (typeof loadResult.then === 'function') {
                    console.log('Promise ë°˜í™˜ í™•ì¸ë¨, then ì²´ì¸ ì‹œì‘');
                    loadResult.then((result) => {
                        console.log('Firebase ë°ì´í„° ë¡œë“œ ì„±ê³µ:', result);
                        hideFirebaseDataSection();
                        
                        if (result && result.format === 'legacy') {
                            alert(`âœ… Firebaseì—ì„œ ë‹¹ì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!\n\nğŸ“Š ì´ ${result.count}ëª…ì˜ ë°ì´í„° (êµ¬ í˜•ì‹)\nğŸ“… ë§ˆì§€ë§‰ ë™ê¸°í™”: ${new Date(result.lastSync).toLocaleString('ko-KR')}\n\nğŸ’¡ ê´€ë¦¬ìì—ê²Œ ìµœì‹  í˜•ì‹ìœ¼ë¡œ ì¬ë°°í¬ë¥¼ ìš”ì²­í•˜ì„¸ìš”.`);
                        } else if (result && result.count) {
                            alert(`âœ… Firebaseì—ì„œ ë‹¹ì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!\n\nğŸ“Š ì´ ${result.count}ëª…ì˜ ë°ì´í„°\nğŸ“¦ ${result.chunks || 1}/${result.totalChunks || 1} ì²­í¬ ë¡œë“œ ì™„ë£Œ\nğŸ“… ë§ˆì§€ë§‰ ë™ê¸°í™”: ${new Date(result.lastSync).toLocaleString('ko-KR')}`);
                        } else {
                            alert('âœ… Firebaseì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                        }
                    }).catch((error) => {
                        console.error('Firebase ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                        alert(`âŒ Firebase ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨\n\n${error.message}\n\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ê±°ë‚˜ ìƒˆ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.`);
                    });
                } else {
                    console.error('loadMemberDataFromFirebaseê°€ Promiseë¥¼ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤:', typeof loadResult);
                    alert('âŒ Firebase ë°ì´í„° ë¡œë“œ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.\në°˜í™˜ê°’ì´ Promiseê°€ ì•„ë‹™ë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('loadFirebaseDataDirectly ì‹¤í–‰ ì¤‘ ì˜ˆì™¸:', error);
                alert(`âŒ Firebase ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n${error.message}\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.`);
            }
        }
        
        // Firebase íƒ­ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
        function loadMemberDataFromFirebaseInTab() {
            return loadFirebaseDataDirectly();
        }
        
        // Firebase ì´ˆê¸°í™” ë° ì—°ê²° ê´€ë¦¬
        async function startFirebaseConnection() {
            try {
                // Firebase ì„¤ì • ìœ íš¨ì„± ê²€ì‚¬
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "YOUR_API_KEY_HERE") {
                    throw new Error('Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. firebaseConfigë¥¼ ì‹¤ì œ í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”.');
                }
                
                // Firebase ì´ˆê¸°í™”
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                
                // ê°œë°œ í™˜ê²½ì—ì„œ ì—ë®¬ë ˆì´í„° ì‚¬ìš© (ì„ íƒì‚¬í•­)
                if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                    try {
                        connectFirestoreEmulator(db, 'localhost', 8080);
                        console.log('ğŸ”§ Firestore ì—ë®¬ë ˆì´í„°ì— ì—°ê²°ë¨');
                    } catch (e) {
                        console.log('ğŸ“¡ ì‹¤ì œ Firestoreì— ì—°ê²°ë¨');
                    }
                }
                
                // ì—°ê²° í…ŒìŠ¤íŠ¸
                await performConnectionTest();
                
                console.log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ');
                isFirebaseReady = true;
                
                // Firebase í•¨ìˆ˜ë“¤ì„ ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
                window.firebaseApp = app;
                window.firebaseDB = db;
                window.firebaseUtils = {
                    collection, doc, setDoc, getDoc, getDocs, deleteDoc, updateDoc, onSnapshot,
                    enableNetwork, disableNetwork
                };
                
                window.firebaseInitialized = true;
                
                // Firebase ì¬ì—°ê²° ì‹œë„ í•¨ìˆ˜ ì •ì˜
                window.retryFirebaseConnection = async function() {
                    console.log('ğŸ”„ Firebase ì¬ì—°ê²° ì‹œë„...');
                    connectionRetryCount = 0;
                    await startFirebaseConnection();
                };
                
                // Firebase ê´€ë ¨ í•¨ìˆ˜ë“¤ ì •ì˜
                defineFirebaseFunctions();
                
                // í—¬í¼ í•¨ìˆ˜ë“¤ ì „ì—­ ë…¸ì¶œ
                window.loadMemberDataFromFirebaseInTab = loadMemberDataFromFirebaseInTab;
                window.loadFirebaseDataDirectly = loadFirebaseDataDirectly;
                window.hideFirebaseDataSection = hideFirebaseDataSection;
                
                // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸ (ì§€ì—° ì‹¤í–‰)
                setTimeout(() => {
                    if (window.updateFirebaseStatus) {
                        window.updateFirebaseStatus(true, 'ì—°ê²°ë¨');
                    }
                }, 100);
                
                console.log('âœ… Firebase í•¨ìˆ˜ë“¤ì´ ì „ì—­ìœ¼ë¡œ ë…¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤');
                
                // ì‹¤ì‹œê°„ ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘
                startConnectionMonitoring();
                
            } catch (error) {
                console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                isFirebaseReady = false;
                
                // í•¨ìˆ˜ê°€ ì •ì˜ëœ í›„ì— í˜¸ì¶œí•˜ë„ë¡ ì§€ì—°
                setTimeout(() => {
                    if (window.updateFirebaseStatus) {
                        window.updateFirebaseStatus(false, `ì´ˆê¸°í™” ì‹¤íŒ¨ - ì˜¤í”„ë¼ì¸ ëª¨ë“œ`);
                    }
                    
                    // ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜
                    activateOfflineMode();
                }, 100);
            }
        }
        
        // Firebase ì—°ê²° í…ŒìŠ¤íŠ¸
        async function performConnectionTest() {
            try {
                const testRef = doc(db, 'system', 'connectionTest');
                await setDoc(testRef, { 
                    timestamp: new Date().toISOString(),
                    status: 'connection_test',
                    version: '1.3'
                }, { merge: true });
                
                const testDoc = await getDoc(testRef);
                if (!testDoc.exists()) {
                    throw new Error('ë¬¸ì„œ ì½ê¸°/ì“°ê¸° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨');
                }
                
                console.log('âœ… Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ');
                return true;
            } catch (error) {
                console.error('âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                throw error;
            }
        }
        
        // Firebase ê´€ë ¨ í•¨ìˆ˜ë“¤ ì •ì˜
        function defineFirebaseFunctions() {
            // ì‚¬ìš©ì ì •ë³´ Firebase ë¡œë“œ
            window.loadUsersFromFirebase = function() {
                return new Promise((resolve, reject) => {
                    console.log('ğŸ”„ Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹œì‘...');
                    
                    if (!isFirebaseReady || !db) {
                        console.log('âŒ Firebase ì—°ê²°ë˜ì§€ ì•ŠìŒ');
                        resolve(false);
                        return;
                    }
                    
                    const statusEl = document.getElementById('syncStatus');
                    if (statusEl) {
                        statusEl.innerHTML = 'ğŸ“¥ Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                    }
                    
                    getDoc(doc(db, 'system', 'users')).then((docSnapshot) => {
                        if (docSnapshot.exists()) {
                            const data = docSnapshot.data();
                            console.log('Firebaseì—ì„œ ë°›ì€ ì‚¬ìš©ì ë°ì´í„°:', data);
                            
                            if (data.users) {
                                const oldUserCount = Object.keys(window.users).length;
                                window.users = data.users;
                                const newUserCount = Object.keys(window.users).length;
                                
                                if (window.saveUsersToStorage) {
                                    window.saveUsersToStorage();
                                }
                                
                                if (statusEl) {
                                    statusEl.innerHTML = `âœ… Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. (${newUserCount}ëª…)`;
                                }
                                
                                console.log('âœ… Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                                console.log(`ì‚¬ìš©ì ìˆ˜: ${oldUserCount} â†’ ${newUserCount}`);
                                
                                if (window.displayUserList) {
                                    window.displayUserList();
                                }
                                
                                alert(`âœ… Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!\n\nğŸ‘¥ ì´ ${newUserCount}ëª…ì˜ ì‚¬ìš©ì\nğŸ“… ë§ˆì§€ë§‰ ë™ê¸°í™”: ${data.lastSync ? new Date(data.lastSync).toLocaleString('ko-KR') : 'ì•Œ ìˆ˜ ì—†ìŒ'}`);
                                
                                resolve(true);
                            } else {
                                console.log('âŒ Firebaseì— ì‚¬ìš©ì ë°ì´í„°ê°€ ì—†ìŒ');
                                if (statusEl) {
                                    statusEl.innerHTML = 'ğŸ“­ Firebaseì— ì €ì¥ëœ ì‚¬ìš©ì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
                                }
                                alert('ğŸ“­ Firebaseì— ì €ì¥ëœ ì‚¬ìš©ì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n\në¨¼ì € ì‚¬ìš©ì ë™ê¸°í™”ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.');
                                resolve(false);
                            }
                        } else {
                            console.log('âŒ Firebase ì‚¬ìš©ì ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ');
                            if (statusEl) {
                                statusEl.innerHTML = 'ğŸ“­ Firebaseì— ì‚¬ìš©ì ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.';
                            }
                            alert('ğŸ“­ Firebaseì— ì‚¬ìš©ì ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.\n\në¨¼ì € ì‚¬ìš©ì ë™ê¸°í™”ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.');
                            resolve(false);
                        }
                    }).catch(error => {
                        console.error('âŒ Firebase ì‚¬ìš©ì ë¡œë“œ ì—ëŸ¬:', error);
                        if (statusEl) {
                            statusEl.innerHTML = `âŒ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`;
                        }
                        alert(`âŒ Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨\n\n${error.message}`);
                        resolve(false);
                    });
                });
            };
            
            // ë‹¹ì› ë°ì´í„° Firebase ë¡œë“œ
            window.loadMemberDataFromFirebase = function() {
                return new Promise((resolve, reject) => {
                    if (!isFirebaseReady || !db) {
                        reject(new Error('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.'));
                        return;
                    }
                    
                    const statusEl = document.getElementById('syncStatus') || document.getElementById('firebaseDataStatus');
                    if (statusEl) {
                        statusEl.innerHTML = 'ğŸ“¥ Firebaseì—ì„œ ë‹¹ì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                    }
                    
                    // ë¨¼ì € ë©”íƒ€ë°ì´í„° ì½ê¸°
                    getDoc(doc(db, 'memberData', 'metadata')).then((metaDoc) => {
                        if (metaDoc.exists()) {
                            const metaData = metaDoc.data();
                            
                            if (metaData.syncVersion === '3.0') {
                                // ìƒˆ ì²­í¬ ê¸°ë°˜ í˜•ì‹
                                loadChunkedData(metaData, statusEl).then(resolve).catch(reject);
                            } else {
                                // êµ¬ í˜•ì‹ ë°ì´í„°
                                loadLegacyData(statusEl).then(resolve).catch(reject);
                            }
                        } else {
                            // ë©”íƒ€ë°ì´í„°ê°€ ì—†ìœ¼ë©´ êµ¬ í˜•ì‹ í™•ì¸
                            loadLegacyData(statusEl).then(resolve).catch(reject);
                        }
                    }).catch(error => {
                        console.error('Firebase ë©”íƒ€ë°ì´í„° ë¡œë“œ ì—ëŸ¬:', error);
                        if (statusEl) {
                            statusEl.innerHTML = `âŒ ë©”íƒ€ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`;
                        }
                        reject(error);
                    });
                });
            };
            
            // ì‚¬ìš©ì ì •ë³´ Firebase ë™ê¸°í™”
            window.syncUsersToFirebase = function() {
                return new Promise((resolve, reject) => {
                    console.log('ğŸ”„ ì‚¬ìš©ì ë™ê¸°í™” ì‹œì‘...');
                    console.log('í˜„ì¬ ì‚¬ìš©ì ë°ì´í„°:', window.users);
                    console.log('Firebase ì—°ê²° ìƒíƒœ:', isFirebaseReady, !!db);
                    
                    if (!isFirebaseReady || !db) {
                        const errorMsg = 'Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.';
                        console.error('âŒ', errorMsg);
                        alert('âŒ Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\nì˜¤í”„ë¼ì¸ ëª¨ë“œì—ì„œëŠ” ë¡œì»¬ ì €ì¥ì†Œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.');
                        reject(new Error(errorMsg));
                        return;
                    }
                    
                    const statusEl = document.getElementById('syncStatus');
                    if (statusEl) {
                        statusEl.innerHTML = 'ğŸ‘¥ ì‚¬ìš©ì ë°ì´í„°ë¥¼ Firebaseì— ë™ê¸°í™”í•˜ëŠ” ì¤‘...';
                    }
                    
                    const syncData = {
                        users: window.users,
                        lastSync: new Date().toISOString(),
                        syncVersion: '2.0',
                        totalUsers: Object.keys(window.users).length
                    };
                    
                    console.log('ë™ê¸°í™”í•  ë°ì´í„°:', syncData);
                    
                    setDoc(doc(db, 'system', 'users'), syncData).then(() => {
                        console.log('âœ… Firebase ì‚¬ìš©ì ë™ê¸°í™” ì„±ê³µ');
                        if (statusEl) {
                            statusEl.innerHTML = `âœ… ì‚¬ìš©ì ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. (${Object.keys(window.users).length}ëª…)`;
                        }
                        
                        setTimeout(() => {
                            alert(`âœ… ì‚¬ìš©ì ì •ë³´ê°€ Firebaseì— ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ‘¥ ì´ ${Object.keys(window.users).length}ëª…ì˜ ì‚¬ìš©ì\nğŸ“… ë™ê¸°í™” ì‹œê°„: ${new Date().toLocaleString('ko-KR')}\n\nì´ì œ ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì´ ì‹œìŠ¤í…œì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                        }, 100);
                        
                        resolve(true);
                    }).catch(error => {
                        console.error('âŒ Firebase ì‚¬ìš©ì ë™ê¸°í™” ì—ëŸ¬:', error);
                        console.error('ì—ëŸ¬ ìƒì„¸:', error.code, error.message);
                        
                        if (statusEl) {
                            statusEl.innerHTML = `âŒ ë™ê¸°í™” ì‹¤íŒ¨: ${error.message}`;
                        }
                        
                        let errorDetail = '';
                        if (error.code === 'permission-denied') {
                            errorDetail = '\n\nğŸ” ê¶Œí•œ ì˜¤ë¥˜: Firestore ë³´ì•ˆ ê·œì¹™ì„ í™•ì¸í•´ì£¼ì„¸ìš”.\nFirebase Console â†’ Firestore Database â†’ ê·œì¹™ì—ì„œ\nallow read, write: if true; ë¡œ ì„¤ì •í•˜ì„¸ìš”.';
                        } else if (error.code === 'unavailable') {
                            errorDetail = '\n\nğŸŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        }
                        
                        alert(`âŒ ì‚¬ìš©ì ë™ê¸°í™” ì‹¤íŒ¨\n\nì˜¤ë¥˜: ${error.message}${errorDetail}`);
                        reject(error);
                    });
                });
            };
            
            // ë‹¹ì› ë°ì´í„° Firebase ë™ê¸°í™”
            window.syncMemberDataToFirebase = function() {
                return new Promise((resolve, reject) => {
                    if (!isFirebaseReady || !db) {
                        reject(new Error('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.'));
                        return;
                    }
                    
                    if (!window.currentData || window.currentData.length === 0) {
                        reject(new Error('ë¨¼ì € ë‹¹ì› ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.'));
                        return;
                    }
                    
                    const statusEl = document.getElementById('syncStatus');
                    if (statusEl) {
                        statusEl.innerHTML = 'ğŸ“Š ë‹¹ì› ë°ì´í„°ë¥¼ Firebaseì— ë™ê¸°í™”í•˜ëŠ” ì¤‘...';
                    }
                    
                    try {
                        const convertedData = [];
                        
                        for (let i = 1; i < window.currentData.length; i++) {
                            const row = window.currentData[i];
                            if (!row || row.length === 0) continue;
                            
                            const name = row[window.columnSettings.name - 1] || '';
                            if (!name.toString().trim()) continue;
                            
                            const memberObj = {
                                id: i,
                                name: name,
                                dob: row[window.columnSettings.dob - 1] || '',
                                phone: window.columnSettings.phone > 0 ? (row[window.columnSettings.phone - 1] || '') : '',
                                dong: window.columnSettings.dong > 0 ? (row[window.columnSettings.dong - 1] || '') : '',
                                age: window.calculateAge ? window.calculateAge(row[window.columnSettings.dob - 1] || '') : 0,
                                ageGroup: window.getAgeGroup ? window.getAgeGroup(window.calculateAge ? window.calculateAge(row[window.columnSettings.dob - 1] || '') : 0) : ''
                            };
                            
                            convertedData.push(memberObj);
                        }
                        
                        const CHUNK_SIZE = 50;
                        const chunks = [];
                        
                        for (let i = 0; i < convertedData.length; i += CHUNK_SIZE) {
                            chunks.push(convertedData.slice(i, i + CHUNK_SIZE));
                        }
                        
                        if (statusEl) {
                            statusEl.innerHTML = `ğŸ“Š ë°ì´í„°ë¥¼ ${chunks.length}ê°œ ì²­í¬ë¡œ ë¶„í• í•˜ì—¬ ë™ê¸°í™” ì¤‘...`;
                        }
                        
                        const metaData = {
                            columnSettings: window.columnSettings,
                            lastSync: new Date().toISOString(),
                            totalMembers: convertedData.length,
                            totalChunks: chunks.length,
                            headers: window.currentData.length > 0 ? window.currentData[0] : [],
                            syncVersion: '3.0'
                        };
                        
                        const metaPromise = setDoc(doc(db, 'memberData', 'metadata'), metaData);
                        
                        const chunkPromises = chunks.map((chunk, index) => {
                            return setDoc(doc(db, 'memberData', `chunk_${index}`), {
                                chunkIndex: index,
                                members: chunk,
                                chunkSize: chunk.length,
                                lastSync: new Date().toISOString()
                            });
                        });
                        
                        Promise.all([metaPromise, ...chunkPromises]).then(() => {
                            if (statusEl) {
                                statusEl.innerHTML = `âœ… ë‹¹ì› ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. (${convertedData.length}ëª…, ${chunks.length}ê°œ ì²­í¬)`;
                            }
                            console.log('Firebase ì²­í¬ ë™ê¸°í™” ì™„ë£Œ:', convertedData.length, 'ëª…,', chunks.length, 'ê°œ ì²­í¬');
                            resolve({
                                success: true,
                                count: convertedData.length,
                                chunks: chunks.length
                            });
                        }).catch(error => {
                            console.error('Firebase ì²­í¬ ë™ê¸°í™” ì—ëŸ¬:', error);
                            if (statusEl) {
                                statusEl.innerHTML = `âŒ ë™ê¸°í™” ì‹¤íŒ¨: ${error.message}`;
                            }
                            reject(error);
                        });
                        
                    } catch (error) {
                        console.error('ë°ì´í„° ë³€í™˜ ì—ëŸ¬:', error);
                        if (statusEl) {
                            statusEl.innerHTML = `âŒ ë°ì´í„° ë³€í™˜ ì‹¤íŒ¨: ${error.message}`;
                        }
                        reject(error);
                    }
                });
            };
            
            // Firebase ì—°ê²° ìƒíƒœ í™•ì¸
            window.checkFirebaseConnection = function() {
                console.log('ğŸ” Firebase ì—°ê²° ìƒíƒœ í™•ì¸...');
                console.log('- isFirebaseReady:', isFirebaseReady);
                console.log('- db ì¡´ì¬:', !!db);
                console.log('- firebaseInitialized:', window.firebaseInitialized);
                
                const isConnected = isFirebaseReady && db && window.firebaseInitialized;
                console.log('- ìµœì¢… ì—°ê²° ìƒíƒœ:', isConnected);
                
                if (!isConnected) {
                    alert('âŒ Firebase ì—°ê²° ìƒíƒœ ë¶ˆëŸ‰\n\nâ€¢ Firebase ì´ˆê¸°í™” ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”\nâ€¢ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”\nâ€¢ ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”\n\nì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ê³„ì† ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('âœ… Firebase ì—°ê²° ìƒíƒœ ì–‘í˜¸\n\nëª¨ë“  í´ë¼ìš°ë“œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                }
                
                return isConnected;
            };
            
            // ì‚¬ìš©ì ìê²© ì¦ëª… ë‹¤ìš´ë¡œë“œ
            window.downloadUserCredentials = function() {
                const userList = Object.keys(window.users).map(username => ({
                    ì‚¬ìš©ìID: username,
                    ë¹„ë°€ë²ˆí˜¸: window.users[username].password,
                    ê¶Œí•œìˆ˜: window.users[username].permissions.length,
                    ê¶Œí•œëª©ë¡: window.users[username].permissions.join(', ')
                }));
                
                const ws = XLSX.utils.json_to_sheet(userList);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'ì‚¬ìš©ìëª©ë¡');
                
                const fileName = `ì‚¬ìš©ì_ê³„ì •_ëª©ë¡_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                alert(`${fileName} íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            };
            
            console.log('âœ… Firebase í•¨ìˆ˜ë“¤ì´ ì•ˆì „í•˜ê²Œ ì •ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì²­í¬ ê¸°ë°˜ ë°ì´í„° ë¡œë“œ
        async function loadChunkedData(metaData, statusEl) {
            if (statusEl) {
                statusEl.innerHTML = `ğŸ“¥ ${metaData.totalChunks}ê°œ ì²­í¬ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...`;
            }
            
            const chunkPromises = [];
            for (let i = 0; i < metaData.totalChunks; i++) {
                const chunkPromise = getDoc(doc(db, 'memberData', `chunk_${i}`));
                chunkPromises.push(chunkPromise);
            }
            
            const chunkDocs = await Promise.all(chunkPromises);
            let allMembers = [];
            let loadedChunks = 0;
            
            chunkDocs.forEach((chunkDoc) => {
                if (chunkDoc.exists()) {
                    const chunkData = chunkDoc.data();
                    if (chunkData.members) {
                        allMembers = allMembers.concat(chunkData.members);
                        loadedChunks++;
                    }
                }
            });
            
            if (allMembers.length > 0) {
                updateUIWithData(allMembers, metaData, statusEl, loadedChunks);
                return {
                    success: true,
                    count: allMembers.length,
                    chunks: loadedChunks,
                    totalChunks: metaData.totalChunks,
                    lastSync: metaData.lastSync
                };
            } else {
                if (statusEl) {
                    statusEl.innerHTML = 'âš ï¸ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
                }
                throw new Error('ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // êµ¬ í˜•ì‹ ë°ì´í„° ë¡œë“œ
        async function loadLegacyData(statusEl) {
            const docSnapshot = await getDoc(doc(db, 'system', 'memberData'));
            
            if (docSnapshot.exists()) {
                const data = docSnapshot.data();
                
                if (data.syncVersion === '2.0' && data.members) {
                    updateUIWithLegacyData(data, statusEl);
                    return {
                        success: true,
                        count: data.members.length,
                        lastSync: data.lastSync,
                        format: 'legacy'
                    };
                } else {
                    if (statusEl) {
                        statusEl.innerHTML = 'âš ï¸ í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.';
                    }
                    throw new Error('í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.');
                }
            } else {
                if (statusEl) {
                    statusEl.innerHTML = 'ğŸ“­ Firebaseì— ì €ì¥ëœ ë‹¹ì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
                }
                throw new Error('Firebaseì— ì €ì¥ëœ ë‹¹ì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        function updateUIWithData(allMembers, metaData, statusEl, loadedChunks) {
            const headers = metaData.headers || ['ì´ë¦„', 'ìƒë…„ì›”ì¼', 'ì „í™”ë²ˆí˜¸', 'ìë©´ë™'];
            const convertedData = [headers];
            
            allMembers.forEach(member => {
                const row = new Array(headers.length);
                row.fill('');
                
                if (metaData.columnSettings) {
                    row[metaData.columnSettings.name - 1] = member.name || '';
                    row[metaData.columnSettings.dob - 1] = member.dob || '';
                    if (metaData.columnSettings.phone > 0) {
                        row[metaData.columnSettings.phone - 1] = member.phone || '';
                    }
                    if (metaData.columnSettings.dong > 0) {
                        row[metaData.columnSettings.dong - 1] = member.dong || '';
                    }
                }
                
                convertedData.push(row);
            });
            
            currentData = convertedData;
            columnSettings = metaData.columnSettings || columnSettings;
            
            const selectedFileEl = document.getElementById('selectedFile');
            if (selectedFileEl) {
                selectedFileEl.textContent = 'âœ… Firebaseì—ì„œ ë¶ˆëŸ¬ì˜¨ ë°ì´í„° (ì²­í¬ ê¸°ë°˜)';
            }
            
            const nameColEl = document.getElementById('nameCol');
            const dobColEl = document.getElementById('dobCol');
            const phoneColEl = document.getElementById('phoneCol');
            const dongColEl = document.getElementById('dongCol');
            
            if (nameColEl) nameColEl.value = columnSettings.name;
            if (dobColEl) dobColEl.value = columnSettings.dob;
            if (phoneColEl) phoneColEl.value = columnSettings.phone || '';
            if (dongColEl) dongColEl.value = columnSettings.dong || '';
            
            if (headers.length > 0) {
                displayHeaderInfo(headers);
                updateCurrentFileInfo('Firebase ë°ì´í„° (ì²­í¬ ê¸°ë°˜)', allMembers.length);
            }
            
            displayAllMembers();
            saveDataToStorage();
            
            // ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateSystemAfterDataLoad();
            
            if (statusEl) {
                statusEl.innerHTML = `âœ… Firebaseì—ì„œ ë‹¹ì› ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. (${allMembers.length}ëª…, ${loadedChunks}/${metaData.totalChunks} ì²­í¬)`;
            }
        }
        
        function updateUIWithLegacyData(data, statusEl) {
            const headers = data.headers || ['ì´ë¦„', 'ìƒë…„ì›”ì¼', 'ì „í™”ë²ˆí˜¸', 'ìë©´ë™'];
            const convertedData = [headers];
            
            data.members.forEach(member => {
                const row = new Array(headers.length);
                row.fill('');
                
                if (data.columnSettings) {
                    row[data.columnSettings.name - 1] = member.name || '';
                    row[data.columnSettings.dob - 1] = member.dob || '';
                    if (data.columnSettings.phone > 0) {
                        row[data.columnSettings.phone - 1] = member.phone || '';
                    }
                    if (data.columnSettings.dong > 0) {
                        row[data.columnSettings.dong - 1] = member.dong || '';
                    }
                }
                
                convertedData.push(row);
            });
            
            currentData = convertedData;
            columnSettings = data.columnSettings || columnSettings;
            
            const selectedFileEl = document.getElementById('selectedFile');
            if (selectedFileEl) {
                selectedFileEl.textContent = 'âœ… Firebaseì—ì„œ ë¶ˆëŸ¬ì˜¨ ë°ì´í„° (êµ¬ í˜•ì‹)';
            }
            
            const nameColEl = document.getElementById('nameCol');
            const dobColEl = document.getElementById('dobCol');
            const phoneColEl = document.getElementById('phoneCol');
            const dongColEl = document.getElementById('dongCol');
            
            if (nameColEl) nameColEl.value = columnSettings.name;
            if (dobColEl) dobColEl.value = columnSettings.dob;
            if (phoneColEl) phoneColEl.value = columnSettings.phone || '';
            if (dongColEl) dongColEl.value = columnSettings.dong || '';
            
            if (headers.length > 0) {
                displayHeaderInfo(headers);
                updateCurrentFileInfo('Firebase ë°ì´í„° (êµ¬ í˜•ì‹)', data.members.length);
            }
            
            displayAllMembers();
            saveDataToStorage();
            
            // ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateSystemAfterDataLoad();
            
            if (statusEl) {
                statusEl.innerHTML = `âœ… Firebaseì—ì„œ ë‹¹ì› ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. (${data.members.length}ëª…, êµ¬ í˜•ì‹)`;
            }
        }
        
        // ì‹¤ì‹œê°„ ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
        function startConnectionMonitoring() {
            if (!db) return;
            
            setInterval(async () => {
                try {
                    if (connectionRetryCount >= maxRetries) {
                        console.log('ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼. ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜');
                        activateOfflineMode();
                        return;
                    }
                    
                    await performConnectionTest();
                    if (window.updateFirebaseStatus) {
                        window.updateFirebaseStatus(true, 'ì—°ê²° ì–‘í˜¸');
                    }
                    connectionRetryCount = 0;
                    
                } catch (error) {
                    connectionRetryCount++;
                    console.error(`ì—°ê²° ìƒíƒœ í™•ì¸ ì‹¤íŒ¨ (${connectionRetryCount}/${maxRetries}):`, error);
                    
                    if (connectionRetryCount >= maxRetries) {
                        if (window.updateFirebaseStatus) {
                            window.updateFirebaseStatus(false, 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ');
                        }
                        activateOfflineMode();
                    } else {
                        if (window.updateFirebaseStatus) {
                            window.updateFirebaseStatus(false, `ì¬ì—°ê²° ì‹œë„ ì¤‘ (${connectionRetryCount}/${maxRetries})`);
                        }
                    }
                }
            }, 30000);
        }
        
        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ í™œì„±í™”
        function activateOfflineMode() {
            console.log('ğŸ”Œ ì˜¤í”„ë¼ì¸ ëª¨ë“œ í™œì„±í™”');
            window.isOfflineMode = true;
            
            setTimeout(() => {
                if (window.updateFirebaseStatus) {
                    window.updateFirebaseStatus(false, 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ (ë¡œì»¬ ì €ì¥ì†Œë§Œ ì‚¬ìš©)');
                }
                
                if (window.showOfflineNotice) {
                    window.showOfflineNotice();
                }
            }, 100);
        }
        
        // Firebase ì´ˆê¸°í™” ì‹¤í–‰
        console.log('ğŸš€ Firebase ì´ˆê¸°í™” ì‹œì‘...');
        startFirebaseConnection();
    </script>
    
    <!-- ì™„ì „í•œ CSS ìŠ¤íƒ€ì¼ ë‚´ì¥ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .firebase-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .connection-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc3545;
            animation: pulse 2s infinite;
        }

        .connection-indicator.connected {
            background: #28a745;
        }

        .connection-indicator.disconnected {
            background: #dc3545;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            position: relative;
        }

        .current-user {
            position: absolute;
            top: 15px;
            left: 20px;
            background: #007bff;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .logout-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .login-screen {
            max-width: 400px;
            margin: 50px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .main-app {
            display: none;
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: transparent;
            color: #666;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            min-width: 120px;
        }

        .tab-btn:hover {
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }

        .tab-btn.active {
            background: #007bff;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .tab-content {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .file-upload {
            border: 2px dashed #007bff;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 123, 255, 0.05);
            margin-bottom: 20px;
        }

        .file-upload:hover {
            border-color: #0056b3;
            background: rgba(0, 123, 255, 0.1);
            transform: translateY(-2px);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .welcome-message {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 5px solid #2196f3;
        }

        .welcome-message h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .welcome-message p {
            color: #424242;
            line-height: 1.6;
        }

        .restore-section {
            background: #d1f2eb;
            border: 2px solid #a3d9d3;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
        }

        .firebase-setup-notice {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            color: #856404;
        }

        .column-setup {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #dee2e6;
        }

        .column-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #dee2e6;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 20px;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-weight: normal;
        }

        .date-input {
            margin-top: 10px;
        }

        .results-area {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            min-height: 300px;
            max-height: 600px;
            overflow-y: auto;
        }

        .results-header {
            background: #007bff;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
        }

        .member-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #007bff;
            transition: all 0.3s ease;
        }

        .member-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .member-item.duplicate {
            border-left-color: #dc3545;
            background: linear-gradient(90deg, rgba(220, 53, 69, 0.05) 0%, rgba(248, 249, 250, 1) 10%);
        }

        .member-item.duplicate:hover {
            background: linear-gradient(90deg, rgba(220, 53, 69, 0.1) 0%, rgba(233, 236, 239, 1) 10%);
        }

        .member-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .member-details {
            color: #6c757d;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .no-data {
            text-align: center;
            color: #6c757d;
            padding: 50px;
            font-style: italic;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.05);
        }

        .sync-section {
            background: #e8f5e8;
            border: 2px solid #c3e6cb;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .sync-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 15px;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .nav-tabs {
                padding: 5px;
            }
            
            .tab-btn {
                padding: 10px 5px;
                font-size: 0.9em;
                min-width: 100px;
            }
            
            .filter-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .column-inputs {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .sync-buttons {
                flex-direction: column;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="firebase-status" id="firebaseStatus">
        <span class="connection-indicator disconnected"></span>
        Firebase ì—°ê²° í™•ì¸ ì¤‘...
    </div>
    
    <div class="container">
        <div class="header">
            <div class="current-user" id="currentUser" style="display: none;"></div>
            <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
            <h2>ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹ ì›ì£¼ê°‘ì§€ì—­ìœ„ì›íšŒ</h2>
            <p>ë‹¹ì›ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        </div>

        <!-- ë¡œê·¸ì¸ í™”ë©´ -->
        <div id="loginScreen" class="login-screen">
            <div class="login-form">
                <h2 style="margin-bottom: 30px; color: #495057;">ì‹œìŠ¤í…œ ë¡œê·¸ì¸</h2>
                <div class="form-group">
                    <label for="username">ì‚¬ìš©ì ID</label>
                    <input type="text" id="username" class="form-control" placeholder="ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="password" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button onclick="login()" class="btn btn-primary" style="width: 100%;">ë¡œê·¸ì¸</button>

            </div>
        </div>

        <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
        <div id="mainApp" class="main-app">
            <div class="nav-tabs">
                <button class="tab-btn active" onclick="showTab('fileSetup')">1. íŒŒì¼/ì—´ ì„¤ì •</button>
                <button class="tab-btn" onclick="showTab('birthdaySearch')">2. ìƒì¼ ê²€ìƒ‰</button>
                <button class="tab-btn" onclick="showTab('memberSearch')">3. ë‹¹ì› ê²€ìƒ‰</button>
                <button class="tab-btn" onclick="showTab('dataManage')">4. ë°ì´í„° ê´€ë¦¬</button>
                <button class="tab-btn" onclick="showTab('statistics')">5. í†µê³„/ì„¤ì •</button>
                <button class="tab-btn" onclick="showTab('userManage')">6. ì‚¬ìš©ì ê´€ë¦¬</button>
            </div>

            <div class="tab-content">
                <!-- íŒŒì¼/ì—´ ì„¤ì • íƒ­ -->
                <div id="fileSetup" class="tab-pane active">
                    <!-- Firebase ì„¤ì • ì•ˆë‚´ -->
                    <div id="firebaseSetupNotice" class="firebase-setup-notice" style="display: none;">
                        <h3 style="color: #856404; margin-bottom: 15px;">ğŸ”§ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
                        <p style="margin-bottom: 15px;">í´ë¼ìš°ë“œ ë™ê¸°í™” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ Firebase í”„ë¡œì íŠ¸ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0; font-family: monospace; font-size: 0.9em;">
                            <strong>ì„¤ì • ë°©ë²•:</strong><br>
                            1. <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a>ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±<br>
                            2. Firestore ë°ì´í„°ë² ì´ìŠ¤ í™œì„±í™”<br>
                            3. í”„ë¡œì íŠ¸ ì„¤ì • â†’ ì¼ë°˜ â†’ ì›¹ì•± ì¶”ê°€<br>
                            4. firebaseConfig ê°ì²´ë¥¼ ë³µì‚¬í•˜ì—¬ ì†ŒìŠ¤ì½”ë“œì— ë¶™ì—¬ë„£ê¸°
                        </div>
                        <button onclick="hideFirebaseNotice()" class="btn btn-warning">ì„¤ì • ì™„ë£Œ í›„ ìˆ¨ê¸°ê¸°</button>
                        <button onclick="testFirebaseConnection()" class="btn btn-info">ì—°ê²° ë‹¤ì‹œ ì‹œë„</button>
                    </div>

                    <!-- Firebase ë°ì´í„° í™•ì¸ ì„¹ì…˜ -->
                    <div id="firebaseDataSection" style="background: #e8f5e8; border: 2px solid #c3e6cb; border-radius: 10px; padding: 10px; margin-bottom: 20px; display: none;">
                        <h3 style="color: #155724; margin-bottom: 15px;">â˜ï¸ Firebase ë°ì´í„° ë°œê²¬</h3>
                        <div id="firebaseDataInfo" style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9em;"></div>
                        <div style="text-align: center;">
                            <button onclick="safeCallFunction('loadFirebaseDataDirectly')" class="btn btn-success">â˜ï¸ Firebase ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                            <button onclick="safeCallFunction('hideFirebaseDataSection')" class="btn btn-info">ğŸ“ ìƒˆ íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°</button>
                        </div>
                    </div>

                    <!-- ë°ì´í„° ì†ŒìŠ¤ ì„ íƒ -->
                    <div style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 10px; padding: 10px; margin-bottom: 10px;">
                        <h3 style="color: #495057; margin-bottom: 15px; text-align: center;">ğŸ“Š ë°ì´í„° ì†ŒìŠ¤ ì„ íƒ</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <!-- ìƒˆ íŒŒì¼ ì—…ë¡œë“œ -->
                            <div class="file-upload" onclick="document.getElementById('excelFile').click()" style="margin-bottom: 0;">
                                <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(event)">
                                <div style="font-size: 1.1em; color: #007bff; margin-bottom: 10px;">ğŸ“‚ ìƒˆ íŒŒì¼ ì—…ë¡œë“œ</div>
                                <p style="color: #6c757d; font-size: 0.9em;">ì—‘ì…€/CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬<br>ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ì‹œì‘í•©ë‹ˆë‹¤</p>
                            </div>
                            
                            <!-- Firebase ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° -->
                            <div class="file-upload" onclick="safeCallFunction('loadFirebaseDataDirectly')" style="margin-bottom: 0; border-color: #28a745; background: #f8fff8;">
                                <div style="font-size: 1.1em; color: #28a745; margin-bottom: 10px;">â˜ï¸ Firebase ë°ì´í„°</div>
                                <p style="color: #6c757d; font-size: 0.9em;">ì„œë²„ì— ì €ì¥ëœ<br>ë‹¹ì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤</p>
                                <div id="firebaseDataStatus" style="color: #6c757d; font-size: 0.8em; margin-top: 10px;">ì˜¤í”„ë¼ì¸ ëª¨ë“œ</div>
                            </div>
                        </div>
                        
                        <p style="color: #856404; font-size: 0.9em; margin-top: 15px; text-align: center;">
                            ğŸ’¡ <strong>íŒ:</strong> Firebase ì—°ê²°ì´ ì•ˆë˜ì–´ë„ ë¡œì»¬ì—ì„œ ì™„ì „íˆ ì‘ë™í•©ë‹ˆë‹¤
                        </p>
                        <p id="selectedFile" style="color: #28a745; font-weight: bold; margin-top: 10px; text-align: center;"></p>
                    </div>

                    <div class="column-setup">
                        <h3 style="color: #e74c3c; margin-bottom: 15px;">ğŸ“Š ë°ì´í„° ì—´ ë²ˆí˜¸ ì„¤ì •</h3>
                        <p style="margin-bottom: 15px; color: #6c757d;">ì—‘ì…€ íŒŒì¼ì˜ ê° í•­ëª©ì— í•´ë‹¹í•˜ëŠ” ì—´ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (0ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)</p>
                        
                        <div id="headerInfo" style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9em; color: #1976d2;"></div>
                        
                        <div class="column-inputs">
                            <div class="form-group">
                                <label>ì´ë¦„ ì—´ ë²ˆí˜¸</label>
                                <input type="number" id="nameCol" class="form-control" min="1" placeholder="ì˜ˆ: 1">
                            </div>
                            <div class="form-group">
                                <label>ìƒë…„ì›”ì¼ ì—´ ë²ˆí˜¸</label>
                                <input type="number" id="dobCol" class="form-control" min="1" placeholder="ì˜ˆ: 2">
                            </div>
                            <div class="form-group">
                                <label>ì „í™”ë²ˆí˜¸ ì—´ ë²ˆí˜¸</label>
                                <input type="number" id="phoneCol" class="form-control" min="0" placeholder="ì˜ˆ: 3 (0: ì‚¬ìš©ì•ˆí•¨)">
                            </div>
                            <div class="form-group">
                                <label>ìë©´ë™ ì—´ ë²ˆí˜¸</label>
                                <input type="number" id="dongCol" class="form-control" min="0" placeholder="ì˜ˆ: 4 (0: ì‚¬ìš©ì•ˆí•¨)">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="saveColumnSettings()" class="btn btn-success">ğŸ’¾ ì—´ ì„¤ì • ì €ì¥</button>
                        </div>
                    </div>
                </div>

                <!-- ìƒì¼ ê²€ìƒ‰ íƒ­ -->
                <div id="birthdaySearch" class="tab-pane">
                    <h3>ğŸ‚ ìƒì¼ ê²€ìƒ‰</h3>
                    
                    <div class="filter-section">
                        <div class="filter-row">
                            <div>
                                <label><strong>ê²€ìƒ‰ ë‚ ì§œ</strong></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="dateOption" value="today" checked onchange="toggleDateOptions()"> ì˜¤ëŠ˜ ìƒì¼</label>
                                    <label><input type="radio" name="dateOption" value="specific" onchange="toggleDateOptions()"> íŠ¹ì • ë‚ ì§œ</label>
                                </div>
                                <input type="date" id="specificDate" class="date-input form-control" style="display: none;">
                            </div>
                            
                            <div>
                                <label><strong>ì—°ë ¹ëŒ€ í•„í„°</strong></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="ageFilter" value="all" checked onchange="toggleAgeFilter()"> ì „ì²´</label>
                                    <label><input type="radio" name="ageFilter" value="specific" onchange="toggleAgeFilter()"> íŠ¹ì • ì—°ë ¹ëŒ€</label>
                                </div>
                                <select id="ageRange" class="form-control" style="display: none;">
                                    <option>10ëŒ€</option>
                                    <option>20ëŒ€</option>
                                    <option>30ëŒ€</option>
                                    <option>40ëŒ€</option>
                                    <option>50ëŒ€</option>
                                    <option>60ëŒ€</option>
                                    <option>70ëŒ€</option>
                                    <option>80ëŒ€ ì´ìƒ</option>
                                </select>
                            </div>
                            
                            <div>
                                <label><strong>ìë©´ë™ í•„í„°</strong></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="dongFilter" value="all" checked onchange="toggleDongFilter()"> ì „ì²´</label>
                                    <label><input type="radio" name="dongFilter" value="specific" onchange="toggleDongFilter()"> íŠ¹ì • ì§€ì—­</label>
                                </div>
                                <input type="text" id="specificDong" class="form-control" placeholder="ìë©´ë™ ì…ë ¥" style="display: none;">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="searchBirthdays()" class="btn btn-primary">ğŸ” ìƒì¼ ê²€ìƒ‰</button>
                            <button onclick="exportResults('birthday')" class="btn btn-success">ğŸ’¾ ê²°ê³¼ ì €ì¥</button>
                            <button onclick="printResults('birthday')" class="btn btn-info">ğŸ–¨ï¸ ê²°ê³¼ ì¸ì‡„</button>
                        </div>
                    </div>

                    <div id="birthdayResults" class="results-area">
                        <div class="no-data">ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒì¼ìë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”.</div>
                    </div>
                </div>

                <!-- ë‹¹ì› ì¡°ê±´ ê²€ìƒ‰ íƒ­ -->
                <div id="memberSearch" class="tab-pane">
                    <h3>ğŸ‘¥ ë‹¹ì› ê²€ìƒ‰</h3>
                    <p style="margin-bottom: 25px; color: #6c757d;">ì´ë¦„ì´ë‚˜ ì „í™”ë²ˆí˜¸ë¡œ ë‹¹ì›ì„ ê²€ìƒ‰í•˜ê³  ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    
                    <div class="filter-section">
                        <div class="filter-row">
                            <div>
                                <label><strong>ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰</strong></label>
                                <input type="text" id="searchByName" class="form-control" placeholder="ë‹¹ì› ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" onkeyup="handleSearchKeyup(event)">
                                <small style="color: #6c757d; margin-top: 5px; display: block;">ë¶€ë¶„ ê²€ìƒ‰ ê°€ëŠ¥ (ì˜ˆ: 'ê¹€' ì…ë ¥ ì‹œ ê¹€ì”¨ ì„±ì„ ê°€ì§„ ëª¨ë“  ë‹¹ì›)</small>
                            </div>
                            
                            <div>
                                <label><strong>ì „í™”ë²ˆí˜¸ë¡œ ê²€ìƒ‰</strong></label>
                                <input type="text" id="searchByPhone" class="form-control" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeyup="handleSearchKeyup(event)">
                                <small style="color: #6c757d; margin-top: 5px; display: block;">ë¶€ë¶„ ê²€ìƒ‰ ê°€ëŠ¥ (ì˜ˆ: '010-1234' ë˜ëŠ” '01012345678')</small>
                            </div>
                            
                            <div>
                                <label><strong>ì§€ì—­ìœ¼ë¡œ ê²€ìƒ‰</strong></label>
                                <input type="text" id="searchByDong" class="form-control" placeholder="ìë©´ë™ì„ ì…ë ¥í•˜ì„¸ìš”" onkeyup="handleSearchKeyup(event)">
                                <small style="color: #6c757d; margin-top: 5px; display: block;">ë¶€ë¶„ ê²€ìƒ‰ ê°€ëŠ¥ (ì˜ˆ: 'ì›ë™' ì…ë ¥ ì‹œ ê´€ë ¨ ì§€ì—­ ëª¨ë‘)</small>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="searchMembersByInput()" class="btn btn-primary">ğŸ” ë‹¹ì› ê²€ìƒ‰</button>
                            <button onclick="clearSearchInputs()" class="btn btn-secondary">ğŸ—‘ï¸ ê²€ìƒ‰ ì´ˆê¸°í™”</button>
                            <button onclick="exportResults('member')" class="btn btn-success">ğŸ’¾ ê²°ê³¼ ì €ì¥</button>
                            <button onclick="printResults('member')" class="btn btn-info">ğŸ–¨ï¸ ê²°ê³¼ ì¸ì‡„</button>
                        </div>
                    </div>

                    <div id="memberSearchResults" class="results-area">
                        <div class="no-data">ì´ë¦„, ì „í™”ë²ˆí˜¸ ë˜ëŠ” ì§€ì—­ì„ ì…ë ¥í•˜ê³  ê²€ìƒ‰í•´ì£¼ì„¸ìš”.</div>
                    </div>
                </div>

                <!-- ë°ì´í„° ê´€ë¦¬ íƒ­ -->
                <div id="dataManage" class="tab-pane">
                    <h3>ğŸ“ ë°ì´í„° ê´€ë¦¬</h3>
                    <p style="margin-bottom: 25px; color: #6c757d;">ë‹¹ì› ì •ë³´ë¥¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    
                    <div style="text-align: center; margin-bottom: 30px;">
                        <button onclick="showAddModal()" class="btn btn-success">â• ìƒˆ ë‹¹ì› ì¶”ê°€</button>
                        <button onclick="showEditModal()" class="btn btn-warning">âœï¸ ë‹¹ì› ì •ë³´ ìˆ˜ì •</button>
                        <button onclick="showDeleteModal()" class="btn btn-danger">ğŸ—‘ï¸ ë‹¹ì› ì‚­ì œ</button>
                    </div>

                    <div id="currentFileInfo" style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #31708f;">
                        í˜„ì¬ ì‘ì—… íŒŒì¼: íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”
                    </div>

                    <div id="allMembersResults" class="results-area">
                        <div class="no-data">íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì—´ ì„¤ì •ì„ ì™„ë£Œí•œ í›„ ì „ì²´ ë‹¹ì› ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                    </div>
                </div>

                <!-- í†µê³„/ì„¤ì • íƒ­ -->
                <div id="statistics" class="tab-pane">
                    <h3>ğŸ“Š í†µê³„ ë° ì„¤ì •</h3>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalMembers">0</div>
                            <div class="stat-label">ì´ ë‹¹ì› ìˆ˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="todayBirthdays">0</div>
                            <div class="stat-label">ì˜¤ëŠ˜ ìƒì¼ì</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgAge">0</div>
                            <div class="stat-label">í‰ê·  ì—°ë ¹</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalAreas">0</div>
                            <div class="stat-label">ê´€ë¦¬ ì§€ì—­ ìˆ˜</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h4 style="margin-bottom: 20px;">ì—°ë ¹ëŒ€ë³„ ë¶„í¬</h4>
                        <canvas id="ageChart" width="400" height="200"></canvas>
                    </div>

                    <div class="chart-container">
                        <h4 style="margin-bottom: 20px;">ì§€ì—­ë³„ ë¶„í¬</h4>
                        <canvas id="areaChart" width="400" height="200"></canvas>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button onclick="refreshStats()" class="btn btn-info">ğŸ”„ í†µê³„ ìƒˆë¡œê³ ì¹¨</button>
                        <button onclick="changePassword()" class="btn btn-warning">ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                        <button onclick="resetSettings()" class="btn btn-danger">âš ï¸ ì„¤ì • ì´ˆê¸°í™”</button>
                    </div>
                </div>

                <!-- ì‚¬ìš©ì ê´€ë¦¬ íƒ­ -->
                <div id="userManage" class="tab-pane">
                    <h3>ğŸ‘¤ ì‚¬ìš©ì ê´€ë¦¬ (ê´€ë¦¬ì ì „ìš©)</h3>
                    <p style="margin-bottom: 25px; color: #6c757d;">ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•˜ê³  ê¶Œí•œì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                    
                    <!-- Firebase ë™ê¸°í™” ì„¹ì…˜ -->
                    <div class="sync-section">
                        <h4 style="color: #155724; margin-bottom: 15px;">ğŸŒ Firebase í´ë¼ìš°ë“œ ë™ê¸°í™” 
                        <span class="connection-indicator" id="syncIndicator"></span></h4>
                        <p style="margin-bottom: 15px; color: #155724;">ì‚¬ìš©ì ì •ë³´ì™€ ë‹¹ì› ë°ì´í„°ë¥¼ ì„œë²„ì— ë™ê¸°í™”í•˜ì—¬ ì¼ë°˜ ì‚¬ìš©ìë“¤ì´ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.</p>
                        
                        <!-- ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì•ˆë‚´ -->
                        <div id="offlineModeNotice" style="display: block; background: #fff3cd; border: 2px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5 style="margin-bottom: 10px;">ğŸ”Œ ì˜¤í”„ë¼ì¸ ëª¨ë“œ</h5>
                            <p style="margin-bottom: 10px;">Firebase ì—°ê²°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì§€ë§Œ ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì€ ë¡œì»¬ì—ì„œ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤:</p>
                            <ul style="margin-left: 20px; margin-bottom: 10px;">
                                <li>ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ (ë¡œì»¬ ì €ì¥ì†Œ)</li>
                                <li>ë‹¹ì› ë°ì´í„° ê´€ë¦¬ (ë¸Œë¼ìš°ì € ë‚´ ì €ì¥)</li>
                                <li>ê²€ìƒ‰ ë° í†µê³„ ê¸°ëŠ¥</li>
                            </ul>
                            <p style="margin-bottom: 0;"><strong>ì œí•œì‚¬í•­:</strong> ë‹¤ë¥¸ ê¸°ê¸°ë‚˜ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                        
                        <div class="sync-buttons">
                            <button onclick="safeCallFunction('syncUsersToFirebase')" class="btn btn-primary">ğŸ‘¥ ì‚¬ìš©ì ë™ê¸°í™”</button>
                            <button onclick="safeCallFunction('loadUsersFromFirebase')" class="btn btn-info">ğŸ“¥ ì‚¬ìš©ì ë¶ˆëŸ¬ì˜¤ê¸°</button>
                            <button onclick="safeCallFunction('syncMemberDataToFirebase')" class="btn btn-success">ğŸ“Š ë‹¹ì› ë°ì´í„° ë°°í¬</button>
                            <button onclick="safeCallFunction('loadMemberDataFromFirebaseInTab')" class="btn btn-info">ğŸ“¥ ë‹¹ì› ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                            <button onclick="safeCallFunction('checkFirebaseConnection')" class="btn btn-info">ğŸ”— ì—°ê²° ìƒíƒœ í™•ì¸</button>
                            <button onclick="safeCallFunction('downloadUserCredentials')" class="btn btn-warning">ğŸ“‹ ì‚¬ìš©ì ê³„ì • ëª©ë¡</button>
                        </div>
                        
                        <div id="syncStatus" style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-size: 0.9em;">Firebase ì—°ê²°ì´ ì—†ì–´ë„ ë¡œì»¬ì—ì„œ ëª¨ë“  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 30px;">
                        <button onclick="showUserModal('add')" class="btn btn-success">â• ì‚¬ìš©ì ì¶”ê°€</button>
                        <button onclick="showUserModal('edit')" class="btn btn-warning">âœï¸ ì‚¬ìš©ì ìˆ˜ì •</button>
                        <button onclick="showUserModal('delete')" class="btn btn-danger">ğŸ—‘ï¸ ì‚¬ìš©ì ì‚­ì œ</button>
                    </div>

                    <div id="userList" class="results-area">
                        <div class="no-data">ì‚¬ìš©ì ëª©ë¡ì„ ë¡œë“œí•˜ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ë“¤ -->
    <div id="firebaseSetupModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close" onclick="closeModal('firebaseSetupModal')">&times;</span>
            <h2>ğŸ”§ Firebase ì„¤ì • ê°€ì´ë“œ</h2>
            <div id="setupContent" style="margin-top: 20px;">
                <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #721c24;">
                    <strong>âš ï¸ Firebase ì—°ê²° ì‹¤íŒ¨</strong><br>
                    í´ë¼ìš°ë“œ ë™ê¸°í™”ë¥¼ ìœ„í•´ì„œëŠ” Firebase í”„ë¡œì íŠ¸ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
                </div>
                
                <h4>ğŸ“‹ ì„¤ì • ë‹¨ê³„:</h4>
                <ol style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                    <li><a href="https://console.firebase.google.com" target="_blank" style="color: #007bff;"><strong>Firebase Console</strong></a>ì— ì ‘ì†í•˜ì—¬ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
                    <li>í”„ë¡œì íŠ¸ì—ì„œ <strong>Firestore Database</strong>ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.</li>
                    <li>í”„ë¡œì íŠ¸ ì„¤ì • â†’ ì¼ë°˜ íƒ­ì—ì„œ <strong>"ì›¹ì•± ì¶”ê°€"</strong>ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.</li>
                    <li>ì•± ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê³  Firebase Hostingì€ ì²´í¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                    <li>ìƒì„±ëœ <code>firebaseConfig</code> ê°ì²´ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.</li>
                    <li>ì´ HTML íŒŒì¼ì˜ ì†ŒìŠ¤ì½”ë“œì—ì„œ <code>firebaseConfig</code> ë¶€ë¶„ì„ ì°¾ì•„ êµì²´í•©ë‹ˆë‹¤.</li>
                </ol>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="testFirebaseConnection()" class="btn btn-primary">ğŸ”„ ì—°ê²° ë‹¤ì‹œ ì‹œë„</button>
                    <button onclick="closeModal('firebaseSetupModal')" class="btn btn-info">ë‚˜ì¤‘ì— ì„¤ì •í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <div id="dataModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('dataModal')">&times;</span>
            <h2 id="modalTitle">ë‹¹ì› ì •ë³´</h2>
            <form id="memberForm">
                <div id="modalFields"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button type="button" onclick="saveMemberData()" class="btn btn-primary">ğŸ’¾ ì €ì¥</button>
                    <button type="button" onclick="closeModal('dataModal')" class="btn btn-danger">âŒ ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <div id="memberSelectModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('memberSelectModal')">&times;</span>
            <h2 id="memberSelectTitle">ìˆ˜ì •í•  ë‹¹ì› ì„ íƒ</h2>
            <div style="margin-bottom: 20px;">
                <div class="form-group">
                    <label>ë‹¹ì› ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰</label>
                    <input type="text" id="searchMemberName" class="form-control" placeholder="ìˆ˜ì •í•  ë‹¹ì›ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" onkeyup="searchMembersForEdit(event)">
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <button onclick="searchMembersForEdit()" class="btn btn-primary">ğŸ” ê²€ìƒ‰</button>
                </div>
            </div>
            <div id="memberSelectResults" class="results-area" style="max-height: 400px;">
                <div class="no-data">ë‹¹ì› ì´ë¦„ì„ ì…ë ¥í•˜ê³  ê²€ìƒ‰í•˜ì„¸ìš”.</div>
            </div>
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeModal('userModal')">&times;</span>
            <h2 id="userModalTitle">ì‚¬ìš©ì ê´€ë¦¬</h2>
            <form id="userForm">
                <div id="userModalFields"></div>
                <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 2px solid #dee2e6;">
                    <button type="button" onclick="saveUserData()" class="btn btn-primary" style="margin-right: 10px;">ğŸ’¾ ì €ì¥</button>
                    <button type="button" onclick="closeModal('userModal')" class="btn btn-danger">âŒ ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì™„ì „í•œ JavaScript ì½”ë“œ êµ¬í˜„ -->
    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let currentData = [];
        let currentUser = '';
        let columnSettings = {
            name: 1,
            dob: 2,
            phone: 3,
            dong: 4
        };
        let excelWorkbook = null;
        let isOfflineMode = true; // ê¸°ë³¸ì ìœ¼ë¡œ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì‹œì‘
        let users = {
            'admin': { 
                password: 'admin', 
                permissions: [
                    '1. íŒŒì¼/ì—´ ì„¤ì •',
                    '2. ìƒì¼ ê²€ìƒ‰', 
                    '3. ë‹¹ì› ê²€ìƒ‰',
                    '4. ë°ì´í„° ê´€ë¦¬',
                    '5. í†µê³„/ì„¤ì •',
                    '6. ì‚¬ìš©ì ê´€ë¦¬'
                ]
            }
        };

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function calculateAge(dob) {
            if (!dob) return 0;
            
            let birthDate;
            
            if (typeof dob === 'number') {
                // ì—‘ì…€ ì‹œë¦¬ì–¼ ë‚ ì§œì¸ ê²½ìš°
                birthDate = new Date((dob - 25569) * 86400 * 1000);
            } else if (typeof dob === 'string') {
                // ë¬¸ìì—´ ë‚ ì§œ ì²˜ë¦¬
                const dateStr = dob.toString().replace(/[^\d]/g, '');
                if (dateStr.length === 8) {
                    // YYYYMMDD í˜•ì‹
                    const year = dateStr.substring(0, 4);
                    const month = dateStr.substring(4, 6);
                    const day = dateStr.substring(6, 8);
                    birthDate = new Date(year, month - 1, day);
                } else if (dateStr.length === 6) {
                    // YYMMDD í˜•ì‹
                    let year = parseInt(dateStr.substring(0, 2));
                    year = year < 30 ? 2000 + year : 1900 + year;
                    const month = dateStr.substring(2, 4);
                    const day = dateStr.substring(4, 6);
                    birthDate = new Date(year, month - 1, day);
                } else {
                    birthDate = new Date(dob);
                }
            } else {
                birthDate = new Date(dob);
            }
            
            if (isNaN(birthDate.getTime())) return 0;
            
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            return age;
        }

        function getAgeGroup(age) {
            if (age < 20) return '10ëŒ€';
            if (age < 30) return '20ëŒ€';
            if (age < 40) return '30ëŒ€';
            if (age < 50) return '40ëŒ€';
            if (age < 60) return '50ëŒ€';
            if (age < 70) return '60ëŒ€';
            if (age < 80) return '70ëŒ€';
            return '80ëŒ€ ì´ìƒ';
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return dateStr;
            return date.toLocaleDateString('ko-KR');
        }

        function isBirthday(dob, targetDate = new Date()) {
            if (!dob) return false;
            
            let birthDate;
            if (typeof dob === 'number') {
                birthDate = new Date((dob - 25569) * 86400 * 1000);
            } else {
                const dateStr = dob.toString().replace(/[^\d]/g, '');
                if (dateStr.length === 8) {
                    const year = dateStr.substring(0, 4);
                    const month = dateStr.substring(4, 6);
                    const day = dateStr.substring(6, 8);
                    birthDate = new Date(year, month - 1, day);
                } else if (dateStr.length === 6) {
                    let year = parseInt(dateStr.substring(0, 2));
                    year = year < 30 ? 2000 + year : 1900 + year;
                    const month = dateStr.substring(2, 4);
                    const day = dateStr.substring(4, 6);
                    birthDate = new Date(year, month - 1, day);
                } else {
                    birthDate = new Date(dob);
                }
            }
            
            if (isNaN(birthDate.getTime())) return false;
            
            return birthDate.getMonth() === targetDate.getMonth() && 
                   birthDate.getDate() === targetDate.getDate();
        }

        // Firebase ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateFirebaseStatus(connected, message) {
            const statusEl = document.getElementById('firebaseStatus');
            const indicator = statusEl.querySelector('.connection-indicator');
            
            if (connected) {
                indicator.className = 'connection-indicator connected';
                statusEl.innerHTML = `<span class="connection-indicator connected"></span>Firebase: ${message}`;
            } else {
                indicator.className = 'connection-indicator disconnected';
                statusEl.innerHTML = `<span class="connection-indicator disconnected"></span>Firebase: ${message}`;
            }
        }

        // Firebase ì—°ê²° í…ŒìŠ¤íŠ¸
        function testFirebaseConnection() {
            if (window.retryFirebaseConnection) {
                window.retryFirebaseConnection();
            } else {
                alert('Firebase ì¬ì—°ê²° ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ê³„ì† ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në¡œì»¬ì—ì„œ ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.');
            }
        }

        // Firebase ì„¤ì • ì•ˆë‚´ ìˆ¨ê¸°ê¸°
        function hideFirebaseNotice() {
            document.getElementById('firebaseSetupNotice').style.display = 'none';
        }

        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ UI ì—…ë°ì´íŠ¸
        function updateOfflineModeUI() {
            const offlineNotice = document.getElementById('offlineModeNotice');
            if (window.isOfflineMode) {
                if (offlineNotice) {
                    offlineNotice.style.display = 'block';
                }
            } else {
                if (offlineNotice) {
                    offlineNotice.style.display = 'none';
                }
            }
        }

        // ì˜¤í”„ë¼ì¸ ì•Œë¦¼ í‘œì‹œ
        function showOfflineNotice() {
            updateOfflineModeUI();
        }

        // ì‚¬ìš©ì ì •ë³´ ì €ì¥ í•¨ìˆ˜
        function saveUsersToStorage() {
            localStorage.setItem('wonju_minjoo_users', JSON.stringify(users));
        }

        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ í•¨ìˆ˜
        function loadUsersFromStorage() {
            const saved = localStorage.getItem('wonju_minjoo_users');
            if (saved) {
                try {
                    const loadedUsers = JSON.parse(saved);
                    console.log('ì €ì¥ëœ ì‚¬ìš©ì ë°ì´í„°:', loadedUsers);
                    
                    if (!loadedUsers.admin) {
                        console.log('admin ê³„ì •ì´ ì—†ì–´ì„œ ìƒˆë¡œ ìƒì„±');
                        loadedUsers.admin = {
                            password: 'admin',
                            permissions: [
                                '1. íŒŒì¼/ì—´ ì„¤ì •',
                                '2. ìƒì¼ ê²€ìƒ‰',
                                '3. ë‹¹ì› ê²€ìƒ‰',
                                '4. ë°ì´í„° ê´€ë¦¬',
                                '5. í†µê³„/ì„¤ì •',
                                '6. ì‚¬ìš©ì ê´€ë¦¬'
                            ]
                        };
                    } else {
                        console.log('ê¸°ì¡´ admin ê³„ì • ë°œê²¬. ë¹„ë°€ë²ˆí˜¸:', loadedUsers.admin.password);
                        if (!loadedUsers.admin.permissions || loadedUsers.admin.permissions.length === 0) {
                            loadedUsers.admin.permissions = [
                                '1. íŒŒì¼/ì—´ ì„¤ì •',
                                '2. ìƒì¼ ê²€ìƒ‰',
                                '3. ë‹¹ì› ê²€ìƒ‰',
                                '4. ë°ì´í„° ê´€ë¦¬',
                                '5. í†µê³„/ì„¤ì •',
                                '6. ì‚¬ìš©ì ê´€ë¦¬'
                            ];
                        }
                        if (!loadedUsers.admin.permissions.includes('6. ì‚¬ìš©ì ê´€ë¦¬')) {
                            loadedUsers.admin.permissions.push('6. ì‚¬ìš©ì ê´€ë¦¬');
                        }
                    }
                    
                    users = loadedUsers;
                    console.log('ìµœì¢… usersê°ì²´:', users);
                    return true;
                } catch (e) {
                    console.log('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', e);
                    localStorage.removeItem('wonju_minjoo_users');
                    return false;
                }
            }
            return false;
        }

        // admin ê³„ì • ê°•ì œ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetAdminAccount() {
            users.admin = {
                password: 'admin',
                permissions: [
                    '1. íŒŒì¼/ì—´ ì„¤ì •',  
                    '2. ìƒì¼ ê²€ìƒ‰',
                    '3. ë‹¹ì› ê²€ìƒ‰',
                    '4. ë°ì´í„° ê´€ë¦¬',
                    '5. í†µê³„/ì„¤ì •',
                    '6. ì‚¬ìš©ì ê´€ë¦¬'
                ]
            };
            saveUsersToStorage();
            console.log('admin ê³„ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ID: admin, PW: admin');
            alert('admin ê³„ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\nID: admin\nPW: admin');
        }

        // ì „ì²´ ì‹œìŠ¤í…œ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetEverything() {
            if (confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€¢ ì‚¬ìš©ì ê³„ì •\nâ€¢ ì—…ë¡œë“œëœ íŒŒì¼\nâ€¢ ëª¨ë“  ì„¤ì •')) {
                localStorage.clear();
                location.reload();
            }
        }

        // ë¡œê·¸ì¸ í•¨ìˆ˜
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            console.log('ë¡œê·¸ì¸ ì‹œë„:', { username, password });
            console.log('í˜„ì¬ users ê°ì²´:', users);

            if (!username || !password) {
                alert('ì‚¬ìš©ì IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            if (!users || !users.admin) {
                console.log('users ê°ì²´ê°€ ì—†ê±°ë‚˜ admin ê³„ì •ì´ ì—†ìŒ. ì´ˆê¸°í™” ì§„í–‰');
                users = {
                    'admin': { 
                        password: 'admin', 
                        permissions: [
                            '1. íŒŒì¼/ì—´ ì„¤ì •',
                            '2. ìƒì¼ ê²€ìƒ‰', 
                            '3. ë‹¹ì› ê²€ìƒ‰',
                            '4. ë°ì´í„° ê´€ë¦¬',
                            '5. í†µê³„/ì„¤ì •',
                            '6. ì‚¬ìš©ì ê´€ë¦¬'
                        ]
                    }
                };
                saveUsersToStorage();
                console.log('users ê°ì²´ ê°•ì œ ì´ˆê¸°í™” ì™„ë£Œ');
            }

            if (users[username] && users[username].password === password) {
                currentUser = username;
                
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('currentUser').style.display = 'block';
                document.getElementById('currentUser').textContent = `${username}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
                
                const logoutBtn = document.getElementById('logoutBtn');
                logoutBtn.style.display = 'block';
                
                applyPermissions();
                
                console.log(`âœ… ${username}ë‹˜ì´ ë¡œê·¸ì¸í–ˆìŠµë‹ˆë‹¤.`);
            } else {
                console.log('ë¡œê·¸ì¸ ì‹¤íŒ¨. ì‚¬ìš©ì ì •ë³´:', users[username]);
                
                if (username === 'admin') {
                    const resetConfirm = confirm(
                        'âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨\n\n' +
                        'admin ê³„ì • ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n' +
                        'ì›ì¸:\n' +
                        'â€¢ ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆê±°ë‚˜\n' +
                        'â€¢ ì €ì¥ëœ ë°ì´í„°ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤\n\n' +
                        'âœ… í™•ì¸: admin ê³„ì •ì„ ê¸°ë³¸ê°’(admin/admin)ìœ¼ë¡œ ì´ˆê¸°í™”\n' +
                        'âŒ ì·¨ì†Œ: ë‹¤ì‹œ ì‹œë„'
                    );
                    
                    if (resetConfirm) {
                        resetAdminAccount();
                        return;
                    }
                }
                
                alert('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨\n\nì‚¬ìš©ì ID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\nğŸ’¡ ìµœì´ˆ ì‚¬ìš© ì‹œ: admin / admin');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                currentUser = '';
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('currentUser').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'none';
            }
        }

        // ê¶Œí•œ ì ìš©
        function applyPermissions() {
            const tabs = document.querySelectorAll('.tab-btn');
            const currentUserData = users[currentUser];
            
            if (!currentUserData) return;
            
            tabs.forEach(tab => {
                const tabText = tab.textContent;
                
                if (currentUser === 'admin') {
                    tab.style.display = 'block';
                    tab.disabled = false;
                    return;
                }
                
                if (tabText === '6. ì‚¬ìš©ì ê´€ë¦¬' && currentUser !== 'admin') {
                    tab.style.display = 'none';
                    return;
                }
                
                if (currentUserData.permissions.includes(tabText)) {
                    tab.style.display = 'block';
                    tab.disabled = false;
                } else {
                    tab.style.display = 'none';
                }
            });
            
            const availableTabs = Array.from(tabs).filter(tab => 
                tab.style.display !== 'none' && !tab.disabled
            );
            if (availableTabs.length > 0) {
                availableTabs[0].click();
            }
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'userManage' && currentUser === 'admin') {
                displayUserList();
                setTimeout(() => {
                    updateOfflineModeUI();
                }, 100);
            } else if (tabName === 'statistics') {
                refreshStats();
            } else if (tabName === 'dataManage') {
                displayAllMembers();
            }
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            console.log('íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘:', file.name);
            document.getElementById('selectedFile').textContent = `ì„ íƒëœ íŒŒì¼: ${file.name}`;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data;
                    
                    if (file.name.endsWith('.csv')) {
                        // CSV íŒŒì¼ ì²˜ë¦¬
                        const csvText = e.target.result;
                        const rows = csvText.split('\n').map(row => row.split(','));
                        data = rows.filter(row => row.some(cell => cell.trim() !== ''));
                    } else {
                        // ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬
                        const workbook = XLSX.read(e.target.result, { type: 'binary' });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        excelWorkbook = workbook;
                    }

                    if (!data || data.length === 0) {
                        alert('íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }

                    currentData = data;
                    console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', data.length, 'í–‰');

                    // í—¤ë” ì •ë³´ í‘œì‹œ
                    if (data.length > 0) {
                        displayHeaderInfo(data[0]);
                        updateCurrentFileInfo(file.name, data.length);
                    }

                    // ë°ì´í„° ì €ì¥
                    saveDataToStorage();

                    // ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
                    updateSystemAfterDataLoad();

                    alert(`âœ… íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ“Š ${data.length}í–‰ì˜ ë°ì´í„°\nğŸ“‹ ì´ì œ ì—´ ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”.`);

                } catch (error) {
                    console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì§€ì›ë˜ëŠ” í˜•ì‹: .xlsx, .xls, .csv');
                }
            };
            
            if (file.name.endsWith('.csv')) {
                reader.readAsText(file, 'UTF-8');
            } else {
                reader.readAsBinaryString(file);
            }
        }

        // ë°ì´í„° ë¡œë“œ í›„ ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSystemAfterDataLoad() {
            console.log('ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œì‘...');
            
            // í˜„ì¬ í™œì„± íƒ­ì´ ìˆë‹¤ë©´ í•´ë‹¹ íƒ­ì˜ ì½˜í…ì¸ ë„ ì—…ë°ì´íŠ¸
            const activeTab = document.querySelector('.tab-pane.active');
            if (activeTab) {
                const tabId = activeTab.id;
                console.log('í˜„ì¬ í™œì„± íƒ­:', tabId);
                
                // ê° íƒ­ì— ë§ëŠ” ì—…ë°ì´íŠ¸ ìˆ˜í–‰
                setTimeout(() => {
                    switch(tabId) {
                        case 'dataManage':
                            displayAllMembers();
                            break;
                        case 'statistics':
                            refreshStats();
                            break;
                        case 'userManage':
                            if (currentUser === 'admin') {
                                displayUserList();
                            }
                            break;
                    }
                }, 100);
            }
            
            // Firebase ë°ì´í„° ì„¹ì…˜ ìˆ¨ê¸°ê¸° (ìƒˆ íŒŒì¼ì„ ì—…ë¡œë“œí–ˆìœ¼ë¯€ë¡œ)
            const firebaseDataSection = document.getElementById('firebaseDataSection');
            if (firebaseDataSection) {
                firebaseDataSection.style.display = 'none';
            }
            
            console.log('ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        // í—¤ë” ì •ë³´ í‘œì‹œ
        function displayHeaderInfo(headers) {
            const headerInfo = document.getElementById('headerInfo');
            if (!headerInfo || !headers) return;
            
            let html = '<strong>ğŸ“‹ íŒŒì¼ í—¤ë” ì •ë³´:</strong><br>';
            headers.forEach((header, index) => {
                html += `${index + 1}ì—´: ${header} /`;
            });
            headerInfo.innerHTML = html;
        }

        // í˜„ì¬ íŒŒì¼ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateCurrentFileInfo(fileName, rowCount) {
            const currentFileInfo = document.getElementById('currentFileInfo');
            if (currentFileInfo) {
                currentFileInfo.innerHTML = `í˜„ì¬ ì‘ì—… íŒŒì¼: <strong>${fileName}</strong> (${rowCount}í–‰)`;
            }
        }

        // ì—´ ì„¤ì • ì €ì¥
        function saveColumnSettings() {
            const nameCol = parseInt(document.getElementById('nameCol').value);
            const dobCol = parseInt(document.getElementById('dobCol').value);
            const phoneCol = parseInt(document.getElementById('phoneCol').value) || 0;
            const dongCol = parseInt(document.getElementById('dongCol').value) || 0;
            
            if (!nameCol || !dobCol) {
                alert('ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ ì—´ ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            if (!currentData || currentData.length === 0) {
                alert('ë¨¼ì € íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const maxCol = currentData[0] ? currentData[0].length : 0;
            if (nameCol > maxCol || dobCol > maxCol || (phoneCol > 0 && phoneCol > maxCol) || (dongCol > 0 && dongCol > maxCol)) {
                alert(`ì—´ ë²ˆí˜¸ëŠ” 1ë¶€í„° ${maxCol}ê¹Œì§€ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }
            
            columnSettings = {
                name: nameCol,
                dob: dobCol,
                phone: phoneCol,
                dong: dongCol
            };
            
            saveDataToStorage();
            
            // ì „ì²´ ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
            updateSystemAfterDataLoad();
            displayAllMembers();
            
            alert('ì—´ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì´ì œ ë‹¤ë¥¸ íƒ­ì—ì„œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }

        // ë°ì´í„° ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
        function saveDataToStorage() {
            if (currentData && currentData.length > 0) {
                localStorage.setItem('wonju_minjoo_data', JSON.stringify({
                    data: currentData,
                    columnSettings: columnSettings,
                    timestamp: new Date().toISOString()
                }));
            }
        }

        // ì „ì²´ ë‹¹ì› ëª©ë¡ í‘œì‹œ
        function displayAllMembers() {
            if (!currentData || currentData.length <= 1) {
                document.getElementById('allMembersResults').innerHTML = '<div class="no-data">í‘œì‹œí•  ë‹¹ì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            let html = '<div class="results-header">ğŸ‘¥ ì „ì²´ ë‹¹ì› ëª©ë¡</div>';
            
            for (let i = 1; i < currentData.length; i++) {
                const row = currentData[i];
                if (!row || row.length === 0) continue;
                
                const name = row[columnSettings.name - 1] || '';
                const dob = row[columnSettings.dob - 1] || '';
                const phone = columnSettings.phone > 0 ? (row[columnSettings.phone - 1] || '') : '';
                const dong = columnSettings.dong > 0 ? (row[columnSettings.dong - 1] || '') : '';
                
                if (!name.toString().trim()) continue;
                
                const age = calculateAge(dob);
                const ageGroup = getAgeGroup(age);
                
                html += `
                    <div class="member-item" onclick="selectMemberForEdit(${i})">
                        <div class="member-name">${name}</div>
                        <div class="member-details">
                            ğŸ‚ ìƒë…„ì›”ì¼: ${formatDate(dob)} (${age}ì„¸, ${ageGroup})<br>
                            ${phone ? `ğŸ“ ì „í™”ë²ˆí˜¸: ${phone}<br>` : ''}
                            ${dong ? `ğŸ  ìë©´ë™: ${dong}` : ''}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('allMembersResults').innerHTML = html;
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥ë“¤
        function toggleDateOptions() {
            const specificDate = document.getElementById('specificDate');
            const dateOption = document.querySelector('input[name="dateOption"]:checked').value;
            
            if (dateOption === 'specific') {
                specificDate.style.display = 'block';
                specificDate.value = new Date().toISOString().split('T')[0];
            } else {
                specificDate.style.display = 'none';
            }
        }

        function toggleAgeFilter() {
            const ageRange = document.getElementById('ageRange');
            const ageFilter = document.querySelector('input[name="ageFilter"]:checked').value;
            
            ageRange.style.display = ageFilter === 'specific' ? 'block' : 'none';
        }

        function toggleDongFilter() {
            const specificDong = document.getElementById('specificDong');
            const dongFilter = document.querySelector('input[name="dongFilter"]:checked').value;
            
            specificDong.style.display = dongFilter === 'specific' ? 'block' : 'none';
        }

        // ìƒˆë¡œìš´ ë‹¹ì› ê²€ìƒ‰ ê¸°ëŠ¥ë“¤
        function handleSearchKeyup(event) {
            if (event.key === 'Enter') {
                searchMembersByInput();
            }
        }

        function clearSearchInputs() {
            document.getElementById('searchByName').value = '';
            document.getElementById('searchByPhone').value = '';
            document.getElementById('searchByDong').value = '';
            document.getElementById('memberSearchResults').innerHTML = '<div class="no-data">ì´ë¦„, ì „í™”ë²ˆí˜¸ ë˜ëŠ” ì§€ì—­ì„ ì…ë ¥í•˜ê³  ê²€ìƒ‰í•´ì£¼ì„¸ìš”.</div>';
        }

        function searchMembersByInput() {
            if (!currentData || currentData.length <= 1) {
                alert('ë¨¼ì € íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì—´ ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }

            const searchName = document.getElementById('searchByName').value.trim();
            const searchPhone = document.getElementById('searchByPhone').value.trim().replace(/[^\d]/g, '');
            const searchDong = document.getElementById('searchByDong').value.trim();

            if (!searchName && !searchPhone && !searchDong) {
                alert('ì´ë¦„, ì „í™”ë²ˆí˜¸ ë˜ëŠ” ì§€ì—­ ì¤‘ í•˜ë‚˜ ì´ìƒì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            let results = [];
            const duplicateTracker = {}; // ì¤‘ë³µ ë°©ì§€ìš©

            for (let i = 1; i < currentData.length; i++) {
                const row = currentData[i];
                if (!row || row.length === 0) continue;

                const name = (row[columnSettings.name - 1] || '').toString();
                const phone = columnSettings.phone > 0 ? (row[columnSettings.phone - 1] || '').toString().replace(/[^\d]/g, '') : '';
                const dong = columnSettings.dong > 0 ? (row[columnSettings.dong - 1] || '').toString() : '';
                const dob = row[columnSettings.dob - 1] || '';

                if (!name.trim()) continue;

                let matches = false;

                // ì´ë¦„ ê²€ìƒ‰
                if (searchName && name.includes(searchName)) {
                    matches = true;
                }

                // ì „í™”ë²ˆí˜¸ ê²€ìƒ‰
                if (searchPhone && phone.includes(searchPhone)) {
                    matches = true;
                }

                // ì§€ì—­ ê²€ìƒ‰
                if (searchDong && dong.includes(searchDong)) {
                    matches = true;
                }

                if (matches) {
                    const age = calculateAge(dob);
                    const ageGroup = getAgeGroup(age);
                    
                    // ì¤‘ë³µ ì œê±°ë¥¼ ìœ„í•œ í‚¤ ìƒì„±
                    const key = `${name}_${phone}_${dong}`;
                    
                    if (!duplicateTracker[key]) {
                        duplicateTracker[key] = [];
                    }
                    
                    duplicateTracker[key].push({
                        index: i,
                        name,
                        dob,
                        phone,
                        dong,
                        age,
                        ageGroup
                    });
                }
            }

            // ì¤‘ë³µëœ ë°ì´í„°ë“¤ì„ ê·¸ë£¹í™”í•˜ì—¬ ê²°ê³¼ ìƒì„±
            const groupedResults = [];
            Object.keys(duplicateTracker).forEach(key => {
                const group = duplicateTracker[key];
                groupedResults.push({
                    key: key,
                    count: group.length,
                    members: group,
                    representative: group[0] // ëŒ€í‘œ ë°ì´í„°
                });
            });

            displayGroupedSearchResults(groupedResults, 'memberSearchResults', 'ğŸ‘¥ ë‹¹ì› ê²€ìƒ‰ ê²°ê³¼');
        }

        function displayGroupedSearchResults(groupedResults, containerId, title) {
            const container = document.getElementById(containerId);
            
            if (groupedResults.length === 0) {
                container.innerHTML = '<div class="no-data">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ë‹¹ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            let totalMembers = 0;
            groupedResults.forEach(group => totalMembers += group.count);

            let html = `<div class="results-header">${title} (${groupedResults.length}ê°œ ê·¸ë£¹, ì´ ${totalMembers}ëª…)</div>`;

            groupedResults.forEach((group, groupIndex) => {
                const rep = group.representative;
                const isDuplicate = group.count > 1;
                
                html += `
                    <div class="member-item ${isDuplicate ? 'duplicate' : ''}" onclick="showMemberGroup(${groupIndex})" style="cursor: pointer;">
                        <div class="member-name">
                            ${rep.name} 
                            ${isDuplicate ? `<span style="color: #dc3545; font-weight: bold;">(${group.count}ëª… ì¤‘ë³µ)</span>` : ''}
                        </div>
                        <div class="member-details">
                            ğŸ‚ ë‚˜ì´: ${rep.age}ì„¸ (${rep.ageGroup})<br>
                            ${rep.phone ? `ğŸ“ ì „í™”ë²ˆí˜¸: ${formatPhoneNumber(rep.phone)}<br>` : ''}
                            ${rep.dong ? `ğŸ  ì£¼ì†Œ: ${rep.dong}` : ''}
                            ${isDuplicate ? '<br><small style="color: #dc3545;">âš ï¸ í´ë¦­í•˜ì—¬ ì¤‘ë³µ ë°ì´í„° í™•ì¸</small>' : '<br><small style="color: #666;">ğŸ‘† í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ ë³´ê¸°</small>'}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            
            // ì „ì—­ ë³€ìˆ˜ì— ê²°ê³¼ ì €ì¥ (ë‚´ë³´ë‚´ê¸°ìš©)
            window.lastGroupedResults = groupedResults;
            window.lastSearchResults = [];
            groupedResults.forEach(group => {
                group.members.forEach(member => {
                    window.lastSearchResults.push(member);
                });
            });
            window.lastSearchTitle = title;
        }

        function formatPhoneNumber(phone) {
            if (!phone) return '';
            const cleaned = phone.replace(/[^\d]/g, '');
            if (cleaned.length === 11) {
                return cleaned.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
            } else if (cleaned.length === 10) {
                return cleaned.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
            }
            return phone;
        }

        function showMemberGroup(groupIndex) {
            const group = window.lastGroupedResults[groupIndex];
            if (!group) return;

            const modalContent = document.getElementById('memberDetailModal');
            if (!modalContent) {
                // ëª¨ë‹¬ì´ ì—†ìœ¼ë©´ ìƒì„±
                createMemberDetailModal();
            }

            const modal = document.getElementById('memberDetailModal');
            const title = document.getElementById('memberDetailTitle');
            const content = document.getElementById('memberDetailContent');

            if (group.count === 1) {
                // ë‹¨ì¼ ë°ì´í„°
                const member = group.members[0];
                title.textContent = `${member.name}ë‹˜ì˜ ìƒì„¸ ì •ë³´`;
                content.innerHTML = `
                    <div style="padding: 20px;">
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #007bff;">ğŸ‘¤ ê¸°ë³¸ ì •ë³´</strong>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <div style="margin-bottom: 10px;"><strong>ì´ë¦„:</strong> ${member.name}</div>
                            <div style="margin-bottom: 10px;"><strong>ìƒë…„ì›”ì¼:</strong> ${formatDate(member.dob)}</div>
                            <div style="margin-bottom: 10px;"><strong>ë‚˜ì´:</strong> ${member.age}ì„¸ (${member.ageGroup})</div>
                            ${member.phone ? `<div style="margin-bottom: 10px;"><strong>ì „í™”ë²ˆí˜¸:</strong> ${formatPhoneNumber(member.phone)}</div>` : ''}
                            ${member.dong ? `<div><strong>ì£¼ì†Œ:</strong> ${member.dong}</div>` : ''}
                        </div>
                        <div style="text-align: center;">
                            <button onclick="editMemberFromDetail(${member.index})" class="btn btn-warning">âœï¸ ì •ë³´ ìˆ˜ì •</button>
                            <button onclick="deleteMemberFromDetail(${member.index})" class="btn btn-danger">ğŸ—‘ï¸ ì‚­ì œ</button>
                        </div>
                    </div>
                `;
            } else {
                // ì¤‘ë³µ ë°ì´í„°
                title.textContent = `${group.representative.name}ë‹˜ - ì¤‘ë³µ ë°ì´í„° (${group.count}ëª…)`;
                let duplicateHtml = `
                    <div style="padding: 20px;">
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #dc3545;">âš ï¸ ì¤‘ë³µëœ ë°ì´í„°ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤</strong>
                        </div>
                `;

                group.members.forEach((member, index) => {
                    duplicateHtml += `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #dc3545;">
                            <div style="margin-bottom: 10px;"><strong>ë°ì´í„° ${index + 1}</strong></div>
                            <div style="margin-bottom: 5px;"><strong>ì´ë¦„:</strong> ${member.name}</div>
                            <div style="margin-bottom: 5px;"><strong>ìƒë…„ì›”ì¼:</strong> ${formatDate(member.dob)}</div>
                            <div style="margin-bottom: 5px;"><strong>ë‚˜ì´:</strong> ${member.age}ì„¸</div>
                            ${member.phone ? `<div style="margin-bottom: 5px;"><strong>ì „í™”ë²ˆí˜¸:</strong> ${formatPhoneNumber(member.phone)}</div>` : ''}
                            ${member.dong ? `<div style="margin-bottom: 10px;"><strong>ì£¼ì†Œ:</strong> ${member.dong}</div>` : ''}
                            <div style="text-align: right;">
                                <button onclick="editMemberFromDetail(${member.index})" class="btn btn-warning" style="margin-right: 5px;">âœï¸ ìˆ˜ì •</button>
                                <button onclick="deleteMemberFromDetail(${member.index})" class="btn btn-danger">ğŸ—‘ï¸ ì‚­ì œ</button>
                            </div>
                        </div>
                    `;
                });

                duplicateHtml += `
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; color: #856404;">
                            <strong>ğŸ’¡ ê¶Œì¥ì‚¬í•­:</strong><br>
                            â€¢ ì •í™•í•œ ì •ë³´ë¥¼ ê°€ì§„ ë°ì´í„° 1ê°œë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ì‚­ì œí•˜ì„¸ìš”<br>
                            â€¢ ì „í™”ë²ˆí˜¸ë‚˜ ì£¼ì†Œê°€ ë‹¤ë¥´ë‹¤ë©´ ë³„ë„ í™•ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                        </div>
                    </div>
                `;
                content.innerHTML = duplicateHtml;
            }

            modal.style.display = 'block';
        }

        function createMemberDetailModal() {
            const modalHtml = `
                <div id="memberDetailModal" class="modal">
                    <div class="modal-content" style="max-width: 600px;">
                        <span class="close" onclick="closeModal('memberDetailModal')">&times;</span>
                        <h2 id="memberDetailTitle">ë‹¹ì› ìƒì„¸ ì •ë³´</h2>
                        <div id="memberDetailContent"></div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function editMemberFromDetail(memberIndex) {
            closeModal('memberDetailModal');
            document.getElementById('modalTitle').textContent = 'ë‹¹ì› ì •ë³´ ìˆ˜ì •';
            showMemberForm(memberIndex);
            window.currentMemberAction = 'edit';
            document.getElementById('dataModal').style.display = 'block';
        }

        function deleteMemberFromDetail(memberIndex) {
            const member = currentData[memberIndex];
            const name = member[columnSettings.name - 1] || '';
            
            if (confirm(`ì •ë§ë¡œ "${name}" ë‹¹ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                currentData.splice(memberIndex, 1);
                saveDataToStorage();
                displayAllMembers();
                closeModal('memberDetailModal');
                
                // ê²€ìƒ‰ ê²°ê³¼ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    searchMembersByInput();
                }, 100);
                
                alert(`"${name}" ë‹¹ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        function searchBirthdays() {
            if (!currentData || currentData.length <= 1) {
                alert('ë¨¼ì € íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì—´ ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const dateOption = document.querySelector('input[name="dateOption"]:checked').value;
            const ageFilter = document.querySelector('input[name="ageFilter"]:checked').value;
            const dongFilter = document.querySelector('input[name="dongFilter"]:checked').value;
            
            let targetDate = new Date();
            if (dateOption === 'specific') {
                const specificDate = document.getElementById('specificDate').value;
                if (!specificDate) {
                    alert('íŠ¹ì • ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                targetDate = new Date(specificDate);
            }
            
            const selectedAgeRange = ageFilter === 'specific' ? document.getElementById('ageRange').value : null;
            const selectedDong = dongFilter === 'specific' ? document.getElementById('specificDong').value.trim() : null;
            
            let results = [];
            
            for (let i = 1; i < currentData.length; i++) {
                const row = currentData[i];
                if (!row || row.length === 0) continue;
                
                const name = row[columnSettings.name - 1] || '';
                const dob = row[columnSettings.dob - 1] || '';
                const phone = columnSettings.phone > 0 ? (row[columnSettings.phone - 1] || '') : '';
                const dong = columnSettings.dong > 0 ? (row[columnSettings.dong - 1] || '') : '';
                
                if (!name.toString().trim()) continue;
                
                if (!isBirthday(dob, targetDate)) continue;
                
                const age = calculateAge(dob);
                const ageGroup = getAgeGroup(age);
                
                if (selectedAgeRange && ageGroup !== selectedAgeRange) continue;
                
                if (selectedDong && !dong.toString().includes(selectedDong)) continue;
                
                results.push({ name, dob, phone, dong, age, ageGroup });
            }
            
            displaySearchResults(results, 'birthdayResults', 'ğŸ‚ ìƒì¼ì ê²€ìƒ‰ ê²°ê³¼', targetDate);
        }

        function displaySearchResults(results, containerId, title, targetDate = null) {
            const container = document.getElementById(containerId);
            
            if (results.length === 0) {
                container.innerHTML = '<div class="no-data">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ë‹¹ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            let html = `<div class="results-header">${title} (${results.length}ëª…)</div>`;
            
            if (targetDate) {
                html += `<div style="text-align: center; margin-bottom: 15px; color: #666;">
                    ê²€ìƒ‰ ë‚ ì§œ: ${targetDate.toLocaleDateString('ko-KR')}
                </div>`;
            }
            
            results.forEach(member => {
                html += `
                    <div class="member-item">
                        <div class="member-name">${member.name}</div>
                        <div class="member-details">
                            ğŸ‚ ìƒë…„ì›”ì¼: ${formatDate(member.dob)} (${member.age}ì„¸, ${member.ageGroup})<br>
                            ${member.phone ? `ğŸ“ ì „í™”ë²ˆí˜¸: ${member.phone}<br>` : ''}
                            ${member.dong ? `ğŸ  ìë©´ë™: ${member.dong}` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            window.lastSearchResults = results;
            window.lastSearchTitle = title;
        }

        // ê²°ê³¼ ë‚´ë³´ë‚´ê¸° ë° ì¸ì‡„
        function exportResults(type) {
            const results = window.lastSearchResults;
            const title = window.lastSearchTitle;
            
            if (!results || results.length === 0) {
                alert('ë‚´ë³´ë‚¼ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const exportData = results.map(member => ({
                ì´ë¦„: member.name,
                ìƒë…„ì›”ì¼: formatDate(member.dob),
                ë‚˜ì´: member.age,
                ì—°ë ¹ëŒ€: member.ageGroup,
                ì „í™”ë²ˆí˜¸: member.phone || '',
                ìë©´ë™: member.dong || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ê²€ìƒ‰ê²°ê³¼');
            
            const fileName = `${title.replace(/[^\wê°€-í£]/g, '_')}_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert(`${fileName} íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        function printResults(type) {
            const results = window.lastSearchResults;
            const title = window.lastSearchTitle;
            
            if (!results || results.length === 0) {
                alert('ì¸ì‡„í•  ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            let html = `
                <html>
                <head>
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #333; text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .print-date { text-align: center; color: #666; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <div class="print-date">ì¸ì‡„ì¼: ${new Date().toLocaleDateString('ko-KR')}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>ë²ˆí˜¸</th>
                                <th>ì´ë¦„</th>
                                <th>ìƒë…„ì›”ì¼</th>
                                <th>ë‚˜ì´</th>
                                <th>ì—°ë ¹ëŒ€</th>
                                <th>ì „í™”ë²ˆí˜¸</th>
                                <th>ìë©´ë™</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            results.forEach((member, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${member.name}</td>
                        <td>${formatDate(member.dob)}</td>
                        <td>${member.age}ì„¸</td>
                        <td>${member.ageGroup}</td>
                        <td>${member.phone || ''}</td>
                        <td>${member.dong || ''}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        }

        // í†µê³„ ê¸°ëŠ¥
        function refreshStats() {
            if (!currentData || currentData.length <= 1) {
                document.getElementById('totalMembers').textContent = '0';
                document.getElementById('todayBirthdays').textContent = '0';
                document.getElementById('avgAge').textContent = '0';
                document.getElementById('totalAreas').textContent = '0';
                return;
            }
            
            let totalMembers = 0;
            let todayBirthdays = 0;
            let totalAge = 0;
            let validAges = 0;
            const areas = new Set();
            const ageGroups = {};
            const dongCounts = {};
            
            const today = new Date();
            
            for (let i = 1; i < currentData.length; i++) {
                const row = currentData[i];
                if (!row || row.length === 0) continue;
                
                const name = row[columnSettings.name - 1] || '';
                const dob = row[columnSettings.dob - 1] || '';
                const dong = columnSettings.dong > 0 ? (row[columnSettings.dong - 1] || '') : '';
                
                if (!name.toString().trim()) continue;
                
                totalMembers++;
                
                const age = calculateAge(dob);
                if (age > 0) {
                    totalAge += age;
                    validAges++;
                    
                    const ageGroup = getAgeGroup(age);
                    ageGroups[ageGroup] = (ageGroups[ageGroup] || 0) + 1;
                }
                
                if (isBirthday(dob, today)) {
                    todayBirthdays++;
                }
                
                if (dong.toString().trim()) {
                    areas.add(dong.toString().trim());
                    dongCounts[dong.toString().trim()] = (dongCounts[dong.toString().trim()] || 0) + 1;
                }
            }
            
            document.getElementById('totalMembers').textContent = totalMembers.toLocaleString();
            document.getElementById('todayBirthdays').textContent = todayBirthdays.toLocaleString();
            document.getElementById('avgAge').textContent = validAges > 0 ? Math.round(totalAge / validAges) : 0;
            document.getElementById('totalAreas').textContent = areas.size;
            
            updateAgeChart(ageGroups);
            updateAreaChart(dongCounts);
        }

        function updateAgeChart(ageGroups) {
            const ctx = document.getElementById('ageChart').getContext('2d');
            
            if (window.ageChartInstance) {
                window.ageChartInstance.destroy();
            }
            
            const labels = ['10ëŒ€', '20ëŒ€', '30ëŒ€', '40ëŒ€', '50ëŒ€', '60ëŒ€', '70ëŒ€', '80ëŒ€ ì´ìƒ'];
            const data = labels.map(label => ageGroups[label] || 0);
            
            window.ageChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ë‹¹ì› ìˆ˜',
                        data: data,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 205, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(199, 199, 199, 0.8)',
                            'rgba(83, 102, 255, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateAreaChart(dongCounts) {
            const ctx = document.getElementById('areaChart').getContext('2d');
            
            if (window.areaChartInstance) {
                window.areaChartInstance.destroy();
            }
            
            const sortedDongs = Object.entries(dongCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const labels = sortedDongs.map(item => item[0]);
            const data = sortedDongs.map(item => item[1]);
            
            window.areaChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 205, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(199, 199, 199, 0.8)',
                            'rgba(83, 102, 255, 0.8)',
                            'rgba(255, 99, 255, 0.8)',
                            'rgba(99, 255, 132, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ë°ì´í„° ê´€ë¦¬ ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function showAddModal() {
            if (!currentData || currentData.length === 0) {
                alert('ë¨¼ì € íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            document.getElementById('modalTitle').textContent = 'ìƒˆ ë‹¹ì› ì¶”ê°€';
            showMemberForm();
            window.currentMemberAction = 'add';
            document.getElementById('dataModal').style.display = 'block';
        }

        function showEditModal() {
            if (!currentData || currentData.length <= 1) {
                alert('ìˆ˜ì •í•  ë‹¹ì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            document.getElementById('memberSelectTitle').textContent = 'ìˆ˜ì •í•  ë‹¹ì› ì„ íƒ';
            document.getElementById('memberSelectModal').style.display = 'block';
        }

        function showDeleteModal() {
            if (!currentData || currentData.length <= 1) {
                alert('ì‚­ì œí•  ë‹¹ì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            document.getElementById('memberSelectTitle').textContent = 'ì‚­ì œí•  ë‹¹ì› ì„ íƒ';
            document.getElementById('memberSelectModal').style.display = 'block';
        }

        function showMemberForm(memberIndex = -1) {
            const isEdit = memberIndex > 0;
            const member = isEdit ? currentData[memberIndex] : null;
            
            const fields = document.getElementById('modalFields');
            fields.innerHTML = `
                <div class="form-group">
                    <label>ì´ë¦„ *</label>
                    <input type="text" id="modalMemberName" class="form-control" value="${isEdit ? (member[columnSettings.name - 1] || '') : ''}" required>
                </div>
                <div class="form-group">
                    <label>ìƒë…„ì›”ì¼ *</label>
                    <input type="date" id="modalMemberDob" class="form-control" value="${isEdit ? formatDateForInput(member[columnSettings.dob - 1]) : ''}" required>
                </div>
                ${columnSettings.phone > 0 ? `
                <div class="form-group">
                    <label>ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="modalMemberPhone" class="form-control" value="${isEdit ? (member[columnSettings.phone - 1] || '') : ''}">
                </div>
                ` : ''}
                ${columnSettings.dong > 0 ? `
                <div class="form-group">
                    <label>ìë©´ë™</label>
                    <input type="text" id="modalMemberDong" class="form-control" value="${isEdit ? (member[columnSettings.dong - 1] || '') : ''}">
                </div>
                ` : ''}
            `;
            
            window.editingMemberIndex = memberIndex;
        }

        function formatDateForInput(dateStr) {
            if (!dateStr) return '';
            
            try {
                let date;
                if (typeof dateStr === 'number') {
                    date = new Date((dateStr - 25569) * 86400 * 1000);
                } else {
                    const cleanStr = dateStr.toString().replace(/[^\d]/g, '');
                    if (cleanStr.length === 8) {
                        const year = cleanStr.substring(0, 4);
                        const month = cleanStr.substring(4, 6);
                        const day = cleanStr.substring(6, 8);
                        date = new Date(year, month - 1, day);
                    } else {
                        date = new Date(dateStr);
                    }
                }
                
                if (isNaN(date.getTime())) return '';
                
                return date.toISOString().split('T')[0];
            } catch (e) {
                return '';
            }
        }

        function searchMembersForEdit(event) {
            if (event && event.key && event.key !== 'Enter') return;
            
            const searchTerm = document.getElementById('searchMemberName').value.trim();
            if (!searchTerm) {
                document.getElementById('memberSelectResults').innerHTML = '<div class="no-data">ë‹¹ì› ì´ë¦„ì„ ì…ë ¥í•˜ê³  ê²€ìƒ‰í•˜ì„¸ìš”.</div>';
                return;
            }
            
            let results = [];
            
            for (let i = 1; i < currentData.length; i++) {
                const row = currentData[i];
                if (!row || row.length === 0) continue;
                
                const name = row[columnSettings.name - 1] || '';
                if (!name.toString().includes(searchTerm)) continue;
                
                const dob = row[columnSettings.dob - 1] || '';
                const phone = columnSettings.phone > 0 ? (row[columnSettings.phone - 1] || '') : '';
                const dong = columnSettings.dong > 0 ? (row[columnSettings.dong - 1] || '') : '';
                const age = calculateAge(dob);
                
                results.push({ index: i, name, dob, phone, dong, age });
            }
            
            if (results.length === 0) {
                document.getElementById('memberSelectResults').innerHTML = '<div class="no-data">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ë‹¹ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            let html = `<div class="results-header">ê²€ìƒ‰ ê²°ê³¼ (${results.length}ëª…)</div>`;
            
            results.forEach(member => {
                html += `
                    <div class="member-item" onclick="selectMemberForAction(${member.index})">
                        <div class="member-name">${member.name}</div>
                        <div class="member-details">
                            ğŸ‚ ìƒë…„ì›”ì¼: ${formatDate(member.dob)} (${member.age}ì„¸)<br>
                            ${member.phone ? `ğŸ“ ì „í™”ë²ˆí˜¸: ${member.phone}<br>` : ''}
                            ${member.dong ? `ğŸ  ìë©´ë™: ${member.dong}` : ''}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('memberSelectResults').innerHTML = html;
        }

        function selectMemberForAction(memberIndex) {
            const title = document.getElementById('memberSelectTitle').textContent;
            
            if (title.includes('ìˆ˜ì •')) {
                document.getElementById('modalTitle').textContent = 'ë‹¹ì› ì •ë³´ ìˆ˜ì •';
                showMemberForm(memberIndex);
                window.currentMemberAction = 'edit';
                closeModal('memberSelectModal');
                document.getElementById('dataModal').style.display = 'block';
            } else if (title.includes('ì‚­ì œ')) {
                const member = currentData[memberIndex];
                const name = member[columnSettings.name - 1] || '';
                
                if (confirm(`ì •ë§ë¡œ "${name}" ë‹¹ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    currentData.splice(memberIndex, 1);
                    saveDataToStorage();
                    displayAllMembers();
                    closeModal('memberSelectModal');
                    alert(`"${name}" ë‹¹ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            }
        }

        function selectMemberForEdit(memberIndex) {
            document.getElementById('modalTitle').textContent = 'ë‹¹ì› ì •ë³´ ìˆ˜ì •';
            showMemberForm(memberIndex);
            window.currentMemberAction = 'edit';
            document.getElementById('dataModal').style.display = 'block';
        }

        function saveMemberData() {
            const name = document.getElementById('modalMemberName').value.trim();
            const dob = document.getElementById('modalMemberDob').value;
            
            if (!name || !dob) {
                alert('ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            
            const phone = document.getElementById('modalMemberPhone') ? 
                          document.getElementById('modalMemberPhone').value.trim() : '';
            const dong = document.getElementById('modalMemberDong') ? 
                         document.getElementById('modalMemberDong').value.trim() : '';
            
            if (window.currentMemberAction === 'add') {
                const newRow = new Array(currentData[0].length).fill('');
                newRow[columnSettings.name - 1] = name;
                newRow[columnSettings.dob - 1] = dob;
                if (columnSettings.phone > 0) newRow[columnSettings.phone - 1] = phone;
                if (columnSettings.dong > 0) newRow[columnSettings.dong - 1] = dong;
                
                currentData.push(newRow);
                alert(`ìƒˆ ë‹¹ì› "${name}"ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } else if (window.currentMemberAction === 'edit') {
                const index = window.editingMemberIndex;
                currentData[index][columnSettings.name - 1] = name;
                currentData[index][columnSettings.dob - 1] = dob;
                if (columnSettings.phone > 0) currentData[index][columnSettings.phone - 1] = phone;
                if (columnSettings.dong > 0) currentData[index][columnSettings.dong - 1] = dong;
                
                alert(`ë‹¹ì› "${name}" ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
            
            saveDataToStorage();
            displayAllMembers();
            closeModal('dataModal');
            
            // ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆë‹¤ë©´ ìƒˆë¡œê³ ì¹¨
            if (window.lastGroupedResults && window.lastGroupedResults.length > 0) {
                setTimeout(() => {
                    const activeTab = document.querySelector('.tab-pane.active');
                    if (activeTab && activeTab.id === 'memberSearch') {
                        searchMembersByInput();
                    }
                }, 100);
            }
        }

        // ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function displayUserList() {
            if (currentUser !== 'admin') {
                document.getElementById('userList').innerHTML = '<div class="no-data">ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            const userList = document.getElementById('userList');
            let html = '<div class="results-header">ğŸ‘¥ ë“±ë¡ëœ ì‚¬ìš©ì ëª©ë¡</div>';
            
            Object.keys(users).forEach(username => {
                const user = users[username];
                const permissionsList = user.permissions.join(', ');
                
                html += `
                    <div class="member-item">
                        <div class="member-name">${username}${username === 'admin' ? ' (ê´€ë¦¬ì)' : ''}</div>
                        <div class="member-details">
                            ğŸ” ë¹„ë°€ë²ˆí˜¸: ${user.password}<br>
                            ğŸ“‹ ê¶Œí•œ: ${permissionsList}
                        </div>
                        ${username !== 'admin' ? `
                            <div style="margin-top: 10px;">
                                <button onclick="editUser('${username}')" class="btn btn-warning">âœï¸ ìˆ˜ì •</button>
                                <button onclick="deleteUser('${username}')" class="btn btn-danger">ğŸ—‘ï¸ ì‚­ì œ</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            userList.innerHTML = html;
        }

        function showUserModal(action) {
            if (currentUser !== 'admin') {
                alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©ìë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            window.currentUserAction = action;
            
            if (action === 'add') {
                document.getElementById('userModalTitle').textContent = 'ìƒˆ ì‚¬ìš©ì ì¶”ê°€';
                showUserForm();
            } else if (action === 'edit') {
                document.getElementById('userModalTitle').textContent = 'ì‚¬ìš©ì ìˆ˜ì •';
                showUserSelectList('edit');
            } else if (action === 'delete') {
                document.getElementById('userModalTitle').textContent = 'ì‚¬ìš©ì ì‚­ì œ';
                showUserSelectList('delete');
            }
            
            document.getElementById('userModal').style.display = 'block';
        }

        function showUserForm(username = '') {
            const isEdit = username !== '';
            const user = isEdit ? users[username] : null;
            
            const fields = document.getElementById('userModalFields');
            fields.innerHTML = `
                <div class="form-group">
                    <label>ì‚¬ìš©ì ID *</label>
                    <input type="text" id="modalUserId" class="form-control" value="${username}" ${isEdit ? 'readonly' : ''} required>
                </div>
                <div class="form-group">
                    <label>ë¹„ë°€ë²ˆí˜¸ *</label>
                    <input type="password" id="modalUserPassword" class="form-control" value="${user ? user.password : ''}" required>
                </div>
                <div class="form-group">
                    <label>ê¶Œí•œ ì„ íƒ *</label>
                    <div style="margin-top: 10px;">
                        ${['1. íŒŒì¼/ì—´ ì„¤ì •', '2. ìƒì¼ ê²€ìƒ‰', '3. ë‹¹ì› ê²€ìƒ‰', '4. ë°ì´í„° ê´€ë¦¬', '5. í†µê³„/ì„¤ì •'].map(permission => `
                            <label style="display: block; margin-bottom: 8px;">
                                <input type="checkbox" value="${permission}" ${user && user.permissions.includes(permission) ? 'checked' : ''}>
                                ${permission}
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
            
            window.editingUser = username;
        }

        function showUserSelectList(action) {
            const fields = document.getElementById('userModalFields');
            let html = '<div class="form-group"><label>ì‚¬ìš©ì ì„ íƒ</label><div style="margin-top: 10px;">';
            
            Object.keys(users).forEach(username => {
                if (username === 'admin') return;
                
                const buttonText = action === 'delete' ? 'ğŸ—‘ï¸ ì‚­ì œ' : 'âœï¸ ìˆ˜ì •';
                const buttonClass = action === 'delete' ? 'btn-danger' : 'btn-warning';
                const onClick = action === 'delete' ? `deleteUserConfirm('${username}')` : `editUserForm('${username}')`;
                
                html += `
                    <div style="padding: 10px; margin-bottom: 10px; border: 1px solid #dee2e6; border-radius: 5px;">
                        <strong>${username}</strong> (${users[username].permissions.length}ê°œ ê¶Œí•œ)<br>
                        <button onclick="${onClick}" class="btn ${buttonClass}" style="margin-top: 5px;">${buttonText}</button>
                    </div>
                `;
            });
            
            html += '</div></div>';
            fields.innerHTML = html;
        }

        function editUserForm(username) {
            showUserForm(username);
        }

        function editUser(username) {
            window.currentUserAction = 'edit';
            document.getElementById('userModalTitle').textContent = `ì‚¬ìš©ì ìˆ˜ì • - ${username}`;
            showUserForm(username);
            document.getElementById('userModal').style.display = 'block';
        }

        function deleteUser(username) {
            deleteUserConfirm(username);
        }

        function deleteUserConfirm(username) {
            if (confirm(`âš ï¸ ì •ë§ë¡œ ì‚¬ìš©ì "${username}"ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œëœ ì‚¬ìš©ìëŠ” ì‹œìŠ¤í…œì— ë¡œê·¸ì¸í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.`)) {
                delete users[username];
                
                // window.usersë„ ë™ê¸°í™”
                window.users = users;
                
                console.log('ì‚¬ìš©ì ì‚­ì œë¨:', username);
                console.log('í˜„ì¬ ì‚¬ìš©ì ëª©ë¡:', users);
                
                saveUsersToStorage();
                displayUserList();
                closeModal('userModal');
                
                alert(`âœ… ì‚¬ìš©ì "${username}"ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nFirebase ë™ê¸°í™”ë¥¼ ì‹¤í–‰í•˜ì—¬ ì„œë²„ì—ì„œë„ ì œê±°í•˜ì„¸ìš”.`);
            }
        }

        function saveUserData() {
            const userId = document.getElementById('modalUserId').value.trim();
            const password = document.getElementById('modalUserPassword').value.trim();
            
            if (!userId || !password) {
                alert('ì‚¬ìš©ì IDì™€ ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            
            const permissions = [];
            document.querySelectorAll('#userModalFields input[type="checkbox"]:checked').forEach(checkbox => {
                permissions.push(checkbox.value);
            });
            
            if (permissions.length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ê¶Œí•œì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (window.currentUserAction === 'add' && users[userId]) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ì IDì…ë‹ˆë‹¤.');
                return;
            }
            
            // ì „ì—­ users ê°ì²´ ì—…ë°ì´íŠ¸
            users[userId] = {
                password: password,
                permissions: permissions
            };
            
            // window.usersë„ ë™ê¸°í™”
            window.users = users;
            
            console.log('ì‚¬ìš©ì ë°ì´í„° ì €ì¥ë¨:', users);
            console.log('window.users ë™ê¸°í™”ë¨:', window.users);
            
            saveUsersToStorage();
            displayUserList();
            closeModal('userModal');
            
            if (window.currentUserAction === 'add') {
                alert(`âœ… ìƒˆ ì‚¬ìš©ì "${userId}"ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì´ì œ Firebase ë™ê¸°í™”ë¥¼ ì‹¤í–‰í•˜ì—¬ ì„œë²„ì— ì—…ë¡œë“œí•˜ì„¸ìš”.`);
            } else {
                alert(`âœ… ì‚¬ìš©ì "${userId}" ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nFirebase ë™ê¸°í™”ë¥¼ ì‹¤í–‰í•˜ì—¬ ì„œë²„ì— ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.`);
            }
        }

        // ì„¤ì • ê´€ë ¨ í•¨ìˆ˜ë“¤
        function changePassword() {
            const newPassword = prompt(`${currentUser}ë‹˜ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`);
            if (!newPassword) return;
            
            if (newPassword.length < 4) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            users[currentUser].password = newPassword;
            saveUsersToStorage();
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function resetSettings() {
            if (confirm('âš ï¸ ëª¨ë“  ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€¢ ì—…ë¡œë“œëœ íŒŒì¼ ë°ì´í„°\nâ€¢ ì—´ ì„¤ì •\nâ€¢ ë¡œì»¬ ì €ì¥ ë°ì´í„°\n\nì‚¬ìš©ì ê³„ì •ì€ ìœ ì§€ë©ë‹ˆë‹¤.')) {
                localStorage.removeItem('wonju_minjoo_data');
                currentData = [];
                columnSettings = { name: 1, dob: 2, phone: 3, dong: 4 };
                
                document.getElementById('selectedFile').textContent = '';
                document.getElementById('headerInfo').innerHTML = '';
                document.getElementById('nameCol').value = '';
                document.getElementById('dobCol').value = '';
                document.getElementById('phoneCol').value = '';
                document.getElementById('dongCol').value = '';
                document.getElementById('allMembersResults').innerHTML = '<div class="no-data">íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì—´ ì„¤ì •ì„ ì™„ë£Œí•œ í›„ ì „ì²´ ë‹¹ì› ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>';
                
                alert('ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë³µì› ê´€ë ¨ í•¨ìˆ˜ë“¤
        function restorePreviousData() {
            const saved = localStorage.getItem('wonju_minjoo_data');
            if (saved) {
                try {
                    const savedData = JSON.parse(saved);
                    currentData = savedData.data;
                    columnSettings = savedData.columnSettings;
                    
                    // ì „ì—­ ë³€ìˆ˜ë„ ì—…ë°ì´íŠ¸
                    window.currentData = currentData;
                    window.columnSettings = columnSettings;
                    
                    document.getElementById('selectedFile').textContent = `âœ… ë³µì›ëœ ë°ì´í„° (${savedData.data.length}í–‰)`;
                    document.getElementById('nameCol').value = savedData.columnSettings.name;
                    document.getElementById('dobCol').value = savedData.columnSettings.dob;
                    document.getElementById('phoneCol').value = savedData.columnSettings.phone || '';
                    document.getElementById('dongCol').value = savedData.columnSettings.dong || '';
                    
                    if (savedData.data.length > 0) {
                        displayHeaderInfo(savedData.data[0]);
                        updateCurrentFileInfo('ë³µì›ëœ ë°ì´í„°', savedData.data.length);
                    }
                    
                    displayAllMembers();
                    
                    // ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
                    updateSystemAfterDataLoad();
                    
                    document.getElementById('restoreSection').style.display = 'none';
                    alert('ì´ì „ ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (error) {
                    console.error('ë°ì´í„° ë³µì› ì˜¤ë¥˜:', error);
                    alert('ë°ì´í„° ë³µì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        function startFresh() {
            localStorage.removeItem('wonju_minjoo_data');
            document.getElementById('restoreSection').style.display = 'none';
            document.getElementById('selectedFile').textContent = '';
            currentData = [];
            alert('ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤. íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
        }

        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.calculateAge = calculateAge;
        window.getAgeGroup = getAgeGroup;
        window.formatDate = formatDate;
        window.isBirthday = isBirthday;
        window.resetAdminAccount = resetAdminAccount;
        window.resetEverything = resetEverything;
        window.saveUsersToStorage = saveUsersToStorage;
        window.loadUsersFromStorage = loadUsersFromStorage;
        window.users = users;
        window.currentData = currentData;
        window.columnSettings = columnSettings;
        window.updateFirebaseStatus = updateFirebaseStatus;
        window.testFirebaseConnection = testFirebaseConnection;
        window.hideFirebaseNotice = hideFirebaseNotice;
        window.updateOfflineModeUI = updateOfflineModeUI;
        window.showOfflineNotice = showOfflineNotice;
        window.updateSystemAfterDataLoad = updateSystemAfterDataLoad;
        window.displayHeaderInfo = displayHeaderInfo;
        window.displayAllMembers = displayAllMembers;
        window.saveDataToStorage = saveDataToStorage;
        window.handleSearchKeyup = handleSearchKeyup;
        window.clearSearchInputs = clearSearchInputs;
        window.searchMembersByInput = searchMembersByInput;
        window.showMemberGroup = showMemberGroup;
        window.editMemberFromDetail = editMemberFromDetail;
        window.deleteMemberFromDetail = deleteMemberFromDetail;
        window.createMemberDetailModal = createMemberDetailModal;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            
            // Firebase ìƒíƒœë¥¼ ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ì¦‰ì‹œ ì„¤ì •
            updateFirebaseStatus(false, 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ (ë¡œì»¬ ì €ì¥ì†Œ ì‚¬ìš©)');
            
            const loadSuccess = loadUsersFromStorage();
            console.log('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ê²°ê³¼:', loadSuccess);
            
            if (!loadSuccess || !users || !users.admin) {
                console.log('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨ ë˜ëŠ” admin ê³„ì • ì—†ìŒ. ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”');
                users = {
                    'admin': { 
                        password: 'admin', 
                        permissions: [
                            '1. íŒŒì¼/ì—´ ì„¤ì •',
                            '2. ìƒì¼ ê²€ìƒ‰', 
                            '3. ë‹¹ì› ê²€ìƒ‰',
                            '4. ë°ì´í„° ê´€ë¦¬',
                            '5. í†µê³„/ì„¤ì •',
                            '6. ì‚¬ìš©ì ê´€ë¦¬'
                        ]
                    }
                };
                saveUsersToStorage();
                console.log('ê¸°ë³¸ admin ê³„ì • ìƒì„± ì™„ë£Œ');
            }
            
            console.log('ìµœì¢… users ê°ì²´:', users);
            
            // Enter í‚¤ë¡œ ë¡œê·¸ì¸
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // ì´ì „ ë°ì´í„° ë³µì› í™•ì¸
            const savedData = localStorage.getItem('wonju_minjoo_data');
            if (savedData) {
                try {
                    const parsed = JSON.parse(savedData);
                    const restoreInfo = document.getElementById('restoreInfo');
                    const restoreSection = document.getElementById('restoreSection');
                    
                    if (restoreInfo && restoreSection) {
                        restoreInfo.innerHTML = `
                            ğŸ“Š ì €ì¥ëœ ë°ì´í„°: ${parsed.data.length}í–‰<br>
                            ğŸ“… ì €ì¥ ì‹œê°„: ${new Date(parsed.timestamp).toLocaleString('ko-KR')}<br>
                            ğŸ”§ ì—´ ì„¤ì •: ì´ë¦„(${parsed.columnSettings.name}), ìƒë…„ì›”ì¼(${parsed.columnSettings.dob}), ì „í™”ë²ˆí˜¸(${parsed.columnSettings.phone}), ìë©´ë™(${parsed.columnSettings.dong})
                        `;
                        restoreSection.style.display = 'block';
                    }
                } catch (error) {
                    console.error('ì €ì¥ëœ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
                    localStorage.removeItem('wonju_minjoo_data');
                }
            }
            
            console.log('ğŸ’¡ ë””ë²„ê¹… ë„ì›€ë§:');
            console.log('- í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í™•ì¸: console.log(users)');
            console.log('- admin ê³„ì • ì´ˆê¸°í™”: resetAdminAccount()');
            console.log('- localStorage ì´ˆê¸°í™”: localStorage.clear()');
            console.log('âœ… ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ëª¨ë“  ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥');
        });

        console.log('âœ… ëª¨ë“  ê¸°ëŠ¥ì´ ì™„ì „íˆ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤ (ì˜¤í”„ë¼ì¸ ëª¨ë“œ).');
    </script>
</body>
</html>
